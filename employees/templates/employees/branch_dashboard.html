{% extends 'base/base.html'%}
{% load cache %}
{% load static %}
{% load crispy_forms_tags %}
{% load humanize %}
{% load filters %}


{% block head %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css.map">
    <link rel="stylesheet" href="{% static 'fontawesome/css/fontawesome.min.css' %}">
    <script src="{% static 'fontawesome/js/fontawesome.min.js' %}"></script>
    <link rel="stylesheet" href="{% static 'generic/styles/view_employee_detail.css' %}"> 
    <link rel="stylesheet" href="{% static 'generic/styles/branch_dashboard.css' %}"> 
    <link rel="stylesheet" href="{% static 'emps/styles/dp_style.css'%}">
    <link rel="stylesheet" href="{% static 'generic/styles/welcome-dashboard.css' %}">
    <script src="{% static 'generic/scripts/branch_dashboard.js' %}"></script>
{% endblock head %}

{% block title %}Branch Dashboard{% endblock title %}
{% block signIn %}<a class="loginBtn btn logoutBtn" href="{% url 'logout' %}" >Logout</a>{% endblock signIn %}
{% block signUp %}{% endblock signUp %}
    {% block dashboard %}
    {% if user.is_superuser %}
        <a href="{% url 'org_dashboard' %}">Org</a>
    {% endif %}
    {% endblock dashboard %}
{% block content %}

    <div class="spinner-container">
        <div class="spinner"></div>
    </div>
    <!-- Error Modal -->
    <div class="modale clickClose" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-contents">
                <div class="modal-header">
                    <h5 class="modal-title" id="errorModalLabel">Error!</h5>
                    <button type="button" class="close close-btn" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p id="errorVal">There was an error processing your request.</p>
                    <i class="fas fa-exclamation-circle text-danger fa-3x"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal-->

    <div class="modale clickClose" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
        <div class="modal-contents">
            <button type="button" class="close close-btn" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            <div class="modal-header">
            <h5 class="modal-title" id="successModalLabel">Success!</h5>
            </div>
            <div class="modal-body">
            <p>Operation completed successfully.</p>
            <i class="fas fa-check-circle text-success fa-3x"></i>
            </div>
        </div>
        </div>
    </div>
        {% comment %} update profile photo {% endcomment %}
        <div id="uploadPhotoModal" class="modale clickClose">
            <div class="modal-contents">
                <span class="close close-btn">&times;</span>
                <h2>Confirm Upload</h2>
                <p>Upload selected photo?</p>
                <div class="modal-buttons">
                    <button class="cancelConfirmBtn">No</button>
                    <button class="proceedUploadBtn">Yes</button>
                </div>
            </div>
        </div>
  
    <div class="dashboard-container">
        <div class="left-pane">
            <div class="org"><center><h5>{{ organization.name|truncatechars:'20' }}<small> ({{branch.name|truncatechars:'15'}})</small></h5></center></div>
            <div class="featuresToggleContainer">   <h5 class="featuresToggle">Features</h5> <div class="rotate180"><i class="fas fa-angle-down"></i></div></div>
            <hr class="hr-dull">
            <ul class="featuresList">
                <div class="fgroup">
                    <li><a class="featuresItem" id="employeeManagement" data-content="employee-management"><i class="fas fa-fw fa-user-tie"></i>Employees</a></li>
                    <li><a class="featuresItem" id="leaveManagement" data-content="leave-management"><i class="fas fa-fw fa-calendar-alt"></i>Leaves</a></li>
                </div>
                <div class="fgroup">
                    <li><a class="featuresItem" id="payrollManagement" data-content="payroll-management"><i class="fas fa-fw fa-file-invoice-dollar"></i>Payrolls</a></li>
                    <li><a class="featuresItem" id="performanceReporting"data-content="performance"><i class="fas fa-fw fa-chart-line"></i>Performances</a></li>
                </div>
                <div class="fgroup">
                    <li><a class="featuresItem" id="transfers" data-content="transfers"><i class="fas fa-fw fa-exchange-alt"></i>Transfers</a></li>
                    <li><a class="featuresItem2" href="{% url 'finance_dashboard' branch_id=branch_id %}" id="finance"><i class="fas fa-fw fa-sack-dollar"></i>Finances</a></li>
                </div>
                <div class="fgroup">
                    <li><a class="featuresItem2" href="{% url 'create_report' branch_id %}" id="reports"><i class="fas fa-fw fa-file-circle-plus"></i>Reports</a></li>
                    <li><a class="featuresItem" id="accountSettings" data-content="settings"><i class="fas fa-fw fa-cog"></i>Settings</a></li>
                </div>
            </ul>
        </div>
        <div class="right-pane">
            <div id="content">
                <div class="backdrop"></div>

                {% comment %} Welcome Section {% endcomment %}
                <div class="welcomeSection mgt">
                    <div class="container">
                        <div class="welcomeTop">
                            <section class="hero">
                                <div class="container">
                                    <h1>Welcome, {{ user.first_name }}</h1>
                                    <div class="profile-picture">
                                        <img src="{{user.profile_picture.url}}" alt="dp icon">
                                    </div>
                                    <small>{{user.email}}</small>
                                    {% cache 86400 branch_slide%}
                                    <section class="featureSlide">
                                        <div class="feature">
                                            <i class="fas fa-users"></i>
                                            <h3>Employees</h3>
                                            <p>Effortlessly manage your branch's workforce.</p>
                                        </div>
                                        <div class="feature">
                                            <i class="fas fa-users"></i>
                                            <h3>Employees</h3>
                                            <p>Effortlessly manage your branch's workforce.</p>
                                        </div>
                                        <div class="feature">
                                            <i class="fas fa-leaf" style="color: green;"></i>
                                            <h3>Leaves</h3>
                                            <p>Handle employee leave requests with ease.</p>
                                        </div>
                                        <div class="feature">
                                            <i class="fas fa-file-invoice-dollar"></i>
                                            <h3>Payrolls</h3>
                                            <p>Streamline payroll management processes.</p>
                                        </div>
                                        <div class="feature">
                                            <i class="fas fa-chart-line"></i>
                                            <h3>Performances</h3>
                                            <p>Track employee performance and set goals.</p>
                                        </div>
                                        <div class="feature">
                                            <i class="fas fa-exchange-alt"></i>
                                            <h3>Transfers</h3>
                                            <p>Manage employee transfers efficiently.</p>
                                        </div>
                                        <div class="feature">
                                            <i class="fas fa-chart-bar"></i>
                                            <h3>Finances</h3>
                                            <p>Monitor financial data and performance.</p>
                                        </div>
                                        <div class="feature">
                                            <i class="fas fa-chart-pie"></i>
                                            <h3>Reports</h3>
                                            <p>Generate insightful reports for analysis.</p>
                                        </div>
                                        <div class="feature">
                                            <i class="fas fa-cog"></i>
                                            <h3>Account Settings</h3>
                                            <p>Customize your dashboard settings.</p>
                                        </div>
                                    </section>
                                    {% endcache %}
                                </div>
                            </section>
                        </div>
                    </div>
                </div>

                
                

                <!-- manage employee -->
                <div class="employee-management mgt">
                    {% cache 86400 emp_menu_toggle %}
                    <div class="menuToggle">
                        <h3 class="hidePrint">Manage Records</h3> <span class="menu-toggle-icon"><i class="fas fa-bars"></i></span>
                    </div>
                    <div class="employee-nav actions">
                        <div class="fgroup">
                            <button class="tab nav-tab active" data-tab="add-employee"><i class="fas fa-user-plus"></i> Add </button>
                            <button class="tab nav-tab" data-tab="view-employees"><i class="fas fa-users"></i> All </button>
                        </div>
                        <div class="fgroup">
                            <button class="tab nav-tab" data-tab="archived-employees"> <i class="fas fa-archive"></i> Archive </button>
                            <button class="tab nav-tab" data-tab="employee-statistics"><i class="fas fa-chart-bar"></i> Stats </button>
                        </div>
                    </div>
                    {% endcache %}
                    {% comment %} Add employee {% endcomment %}
                    <div class="tab-contents" id="add-employee">
                        <!-- Leave Requests content -->
                        <div class="searchFlex">
                            <h4>Add Employee</h4> <button class="btn btn-primary" id="uploadDataBtn">Upload Excel or CSV file</button>
                        </div>                  
                        <form action="{% url 'create_employee' branch_id %}" method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                            {% crispy form %}                    
                        </form>
                        <div class="container multiUpload empModalContainer" id="empUploadForm">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">&times;</button>
                            <form action="{% url 'create_from_file' branch_id %}" method="post" enctype="multipart/form-data">
                                {% csrf_token %}

                                <div class="up-upload-header">
                                    <h2>Upload Employee Records</h2>
                                    <p class="up-info-text">Easily add new employees by uploading an Excel or CSV file.</p>
                                </div>
                                
                                <div class="up-instructions">
                                    <ul class="up-instruction-list">
                                    <li>
                                        <span class="up-highlight">Employee ID:</span>
                                        Leave empty for auto-generation, or enter a unique ID. Duplicates will cause errors.
                                    </li>
                                    <li>
                                        <span class="up-highlight">Other Fields:</span>
                                        Fill out remaining fields with accurate data. Empty fields are allowed for optional information.
                                    </li>
                                    <li>
                                        <span class="up-highlight">File Requirements:</span>
                                        <ul>
                                        <li>Excel (.xls, .xlsx) or CSV format</li>
                                        <li>Not password protected</li>
                                        </ul>
                                    </li>
                                    <li>
                                        <span class="up-highlight">Important:</span>
                                        <ul>
                                        <li>
                                            The first two rows in the sample template are for illustration only. Please delete them before upload.
                                        </li>
                                        <li>
                                            Data entry mistakes may lead to upload errors. Carefully review entries before uploading.
                                        </li>
                                        </ul>
                                    </li>
                                    </ul>
                                
                                    <p class="up-download-text">Download a sample template:</p>
                                    <b>
                                        <a href="{% static 'sample/excel/payroll_template.xlsx' %}" download class="up-download-link">Excel (.xls, .xlsx)</a> or
                                        <a href="{% static 'sample/csv/payroll_template.csv' %}" download class="up-download-link"> CSV</a>
                                    </b>
                                </div>                           
                                {% crispy employees_upload_form %}
                            
                            </form>
                        </div>                    
                    </div>

                    
                    {% comment %} archived employees list table {% endcomment %}
                    <div class="tab-contents" id="archived-employees">
                        <!-- Leave History content -->
                        {% if archived_employees %}
                        <div class="searchFlex">
                            <h4>Archived  Employees</h4> <button class="btn btn-primary" onclick="window.print()">Print</button>
                        </div>
                        <table class="dataTable archive-employee-table apply-leave">
                            <thead>
                                <tr>
                                    <th>SN</th>
                                    <th>ID</th>
                                    <th>Employee</th>
                                    <th>Department</th>
                                    <th>Archived At</th>
                                    <th>Archived By</th>
                                    <th>More</th>
                                </tr>
                            </thead>
                            <tbody class="employee-table-body">
                                {% for employee in archived_employees %}
                                <tr class="s-card">
                                    <td>{{ forloop.counter }}</td>
                                    <td class="sf2">{{ employee.employee_id }}</td>
                                    <td class="sf1">{{ employee.first_name}} {{ employee.last_name }}</td>
                                    <td>{{ employee.department }}</td>
                                    <td>{{ employee.archived_at|date:'d/m/y' }}</td>
                                    <td>{{ employee.archived_by }}</td>
                                    <td>
                                        <div class="dropdown">
                                            <i class="fas fa-ellipsis-h" aria-hidden="true"></i>
                                            <div class="dropdown-menu">
                                                <center>
                                                <ul>
                                                    <li><a class="moreEmpDetail EmpArchiveBtn" id="restoreEmpArchiveBtn" data-employeeID="{{ employee.employee_id }}" data-content="restoreEmpArchiveContainer">Restore</a></li>
                                                    <li><a class="moreEmpDetail DelArchiveBtn"  id="deleteEmpArchiveBtn" data-employeeID="{{ employee.employee_id }}"  data-content="deleteEmpArchiveContainer">Delete</a></li>
                                                </ul>
                                            </center>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
        
                        {% else %}
                        <center>
                            <h4>No Archived Employees</h4>
                            <p>Archived employees will appear here</p>
                        </center>
                        {% endif %}

                    </div>


                {% comment %} summary table view of employees{% endcomment %}
                    <div class="tab-contents" id="view-employees">
                            {% if employees %}
                            <div class="searchFlex">
                                <h4>All Employees</h4> <button class="btn btn-primary" onclick="window.print()">Print</button>
                            </div>
                                <table class="dataTable view-employee-table apply-leave">
                                    <thead>
                                        <tr>
                                            <th>SN</th>
                                            <th>ID</th>
                                            <th>Employee</th>
                                            <th>Department</th>
                                            <th>Role</th>
                                            <th>Status</th>
                                            <th>More</th>
                                        </tr>
                                    </thead>
                                    <tbody class="employee-table-body">
                                        {% for employee in employees %}
                                        <tr class="s-card">
                                            <td>{{ forloop.counter }}</td>
                                            <td class="sf2">{{ employee.employee_id }}</td>
                                            <td class="sf1">{{ employee.first_name }} {{ employee.last_name }}</td>
                                            <td class="sf3">{{ employee.department }}</td>
                                            <td class="sf4">{{ employee.job_role }}</td>
                                            <td>{{ employee.employment_status }}</td>
                                            <td>
                                                <div class="dropdown">
                                                    <i class="fas fa-ellipsis-h" aria-hidden="true"></i>
                                                    <div class="dropdown-menu">
                                                        <center>
                                                        <ul>
                                                            <li><a class="moreEmpDetail viewEmpDetailBtn"  data-employeeID="{{ employee.pk }}" data-content="viewEmpDetailContainer">View</a></li>
                                                            <li><a class="moreEmpDetail editEmpDetailBtn" data-employeeID="{{ employee.pk }}" data-content="updateEmpDetailContainer">Edit</a></li>
                                                            <li><a class="moreEmpDetail archiveEmpDetailBtn"  data-employeeID="{{ employee.employee_id}}"  data-content="archiveEmpDetailContainer">Archive</a></li>
                                                            <li><a class="moreEmpDetail deleteEmpDetailBtn"  data-employeeID="{{ employee.employee_id}}"  data-content="deleteEmpDetailContainer">Delete</a></li>
                                                        </ul>
                                                    </center>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                
                                {% else %}
                                <center>
                                    <h4>No Employees</h4>
                                    <p>Add employees to have them displayed here</p>
                                </center>
                                {% endif %}
                    </div>



                    {% comment %} delete employee {% endcomment %}
                    <div class="tab-contents statistics" id="employee-statistics">
                        <h3>Employee Statistics</h3>
                        <div class="statistics-grid">
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="statistic-info">
                                    <h3>Total Employees</h3>
                                    {% if total_employees_count %}
                                    <p class="statsVal">{{ total_employees_count|intcomma }}</p>
                                    {% else %}
                                    <p class="statsVal"style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                    <i class="fas fa-archive badStat"></i>
                                </div>
                                <div class="statistic-info">
                                    <h3>Archived Employees</h3>
                                    <p class="statsVal">{{ archived_employees_count|intcomma }}</p>
                                </div>
                            </div>
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                    <i class="fas fa-user-clock"></i>
                                </div>
                                <div class="statistic-info">
                                    <h3>Current Employees on Leave</h3>
                                    {% if total_employees_on_leave_count is not None %}
                                    <p class="statsVal">{{ total_employees_on_leave_count|intcomma }}</p>
                                    {% else %}
                                    <p class="statsVal" style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                    <i class="fas fa-users-rectangle goodStat"></i>
                                </div>
                                <div class="statistic-info">
                                    <h3>Active Employees</h3>
                                    {% if active_employees_count is not None %}
                                    <p class="statsVal">{{ active_employees_count|intcomma }}</p>
                                    {% else %}
                                    <p class="statsVal" style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                    <i class="fas fa-user-times badStat"></i>
                                </div>
                                <div class="statistic-info">
                                    <h3>Inactive Employees</h3>
                                    {% if inactive_employees_count is not None %}
                                    <p class="statsVal">{{ inactive_employees_count|intcomma }}</p>
                                    {% else %}
                                    <p class="statsVal" style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                    <i class="fas fa-user-plus goodStat"></i>
                                </div>
                                <div class="statistic-info">
                                    <h3>New Hires This Month</h3>
                                    {% if monthly_created_employees is not None %}
                                    <p class="statsVal">{{ monthly_created_employees|intcomma }}</p>
                                    {% else %}
                                    <p class="statsVal" style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                
                    {% comment %} modal for view {% endcomment %}

                
            
                    <div class="container view_emp_container empModalContainer openFlashMsg" id="viewEmpDetailContainer">
                        <div class="main_block">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true"onclick="document.getElementById('viewEmpDetailContainer').style.display='none' document.getElementByClassName('backdrop').style.display='none'">&times;</span>
                            </button>
                            <form class="employee_view_form">
                                <div class="profile-picture">
                                    <img id="profilePictureView" src="" alt="dp icon">
                                </div>
                                <!-- Personal Details -->
                                <fieldset>
                                    <legend>
                                        <h3>Personal Details</h3>
                                    </legend>
                                    <div class="personal-details detail-section form-row">
                                        <div><label class="detail-label">Name: <span id="empFullNameView" class="detail-value"></span></label> <label class="detail-label">Email: <span id="emailView" class="detail-value"></span></label></div>
                                        <div><label class="detail-label">Phone: <span id="phone_numberView" class="detail-value"></span></label> <label class="detail-label">Gender: <span id="genderView" class="detail-value"></span></label></div>
                                    </div>
                                    <div class="personal-details detail-section form-row">
                                        <div><label class="detail-label">DOB: <span id="dobView" class="detail-value"></span></label> <label class="detail-label">Marital Status: <span id="marital_statusView" class="detail-value"></span></label></div>
                                        <div><label class="detail-label">Nationality:<span id="nationalityView" class="detail-value"></span></label> <label class="detail-label">State of Origin: <span id="state_of_originView" class="detail-value"></span></label></div>
                                    </div>
                                    <div class="personal-details detail-section form-row">
                                        <div><label class="detail-label">Address: <span id="addressView" class="detail-value"></span></label> </div>
                                    </div>
                                </fieldset>
                    
                                <!-- Job Details -->
                                <fieldset>
                                    <legend><h3>Job Information</h3></legend>
                                    <div class="job-details detail-section form-row">
                                        <div><label class="detail-label">Employee ID: <span id="employee_idView" class="detail-value"></span></label><label class="detail-label">Department/Division: <span id="departmentView" class="detail-value"></span></label></div>
                                        <div><label class="detail-label">Job Role: <span id="job_roleView" class="detail-value"></span></label><label class="detail-label">Joining Date: <span id="joining_dateView" class="detail-value"></span></label></div>
                                    </div>
                                    <div class="job-details detail-section form-row">
                                        <div><label class="detail-label">Employment Type: <span id="employment_typeView" class="detail-value"></span></label><label class="detail-label">Employment Status: <span id="employment_statusView" class="detail-value"></span></label></div>
                                        <div><label class="detail-label">Designation: <span id="designationView" class="detail-value"></span></label><label class="detail-label">Level: <span id="levelView" class="detail-value"></span></label></div>
                                    </div>
                                    <div class="job-details detail-section form-row">
                                        <div><label class="detail-label">Last Promoted: <span id="last_promotion_dateView" class="detail-value"></span></label><label class="detail-label">Next Promotion: <span id="next_promotion_dateView" class="detail-value"></span></label></div>
                                        <div><label class="detail-label">Salary: <span id="salaryView" class="detail-value"></span></label></div>
                                    </div>
                                </fieldset>
                                
                                <!-- Bank Details -->
                                <fieldset>
                                    <legend><h3>Bank Information</h3></legend>
                                    <div class="bank-details detail-section form-row">
                                        <div>
                                            <label class="detail-label">Bank Name: <span id="bankNameView" class="detail-value"></span></label>
                                            <label class="detail-label">Account Number: <span id="accountNumberView" class="detail-value"></span></label>
                                        </div>
                                        <div>
                                            <label class="detail-label">Account Name: <span id="accountNameView" class="detail-value"></span></label>
                                            <label class="detail-label">Pension ID: <span id="pensionIdView" class="detail-value"></span></label>
                                        </div>
                                    </div>
                                    <div class="btnHandle">
                                        <label class="detail-label">Tax ID: <span id="taxIdView" class="detail-value"></span></label>
                                    </div>
                                </fieldset>
                                
                                <!--Next  Of Kin -->
                                <fieldset>
                                    <legend><h3>Next of Kin Information</h3></legend>
                                    <div class="kin-details detail-section form-row">
                                        <div>
                                            <label class="detail-label">Next of Kin Name: <span id="next_of_kin_nameView" class="detail-value"></span></label>
                                            <label class="detail-label">Relationship: <span id="next_of_kin_relationshipView" class="detail-value"></span></label>
                                        </div>
                                        <div>
                                            <label class="detail-label">Phone Number: <span id="next_of_kin_phone_numberView" class="detail-value"></span></label>
                                        </div>
                                    </div>
                                </fieldset>

                                <!-- Other Information -->
                                <fieldset>
                                    <legend><h3>Other Information</h3></legend>
                                    <div class="other-details detail-section form-row">
                                        <div><label class="detail-label">Emergency Contacts: <span id="emergency_contactsView" class="detail-value"></span></label><label class="detail-label">Termination/Resignation Date: <span id="termination_resignation_dateView" class="detail-value"></span></label></div>
                                        <div><label class="detail-label">Highest Qualification: <span id="highest_qualificationView" class="detail-value"></span></label><label class="detail-label">Skills/Qualifications: <span id="skills_qualificationsView" class="detail-value"></span></label></div>
                                    </div>
                                    <div class="other-details detail-section form-row">
                                        <div><label class="detail-label">Highest Certificate: <span class="detail-value"><a id="highest_certificateView" class="empFileView" href="" target="_blank">View</a></span></label></div>
                                        <div><label class="detail-label">Employment Letter: <span class="detail-value"><a id="employment_letterView" class="empFileView"  href=""target="_blank">View</a></span></label></div>
                                    </div>
                                </fieldset>
                                
                                <!-- supervised employees -->
                                <fieldset>
                                    <legend><h3>Supervised Employees</h3></legend>
                                    <div class="supervision-details detail-section form-row">
                                        <div><label class="detail-label">Supervised Employees:</label></div>
                                        <div>
                                            <ul class="supervised-list" id="supervised_employeesView">
                                                <!-- Supervised employees will be dynamically inserted here -->
                                            </ul>
                                        </div>
                                    </div>
                                </fieldset>
                    
                                <!-- Activity TimeStamp -->
                                <fieldset>
                                    <legend><h3>Timestamps</h3></legend>
                                    <div class="time-details detail-section form-row">
                                        <div><label class="detail-label">Created At: <span id="created_atView" class="detail-value"></span></label></div>
                                        <div><label class="detail-label">Last Updated: <span id="updated_atView" class="detail-value"></span></label></div>
                                    </div>
                                </fieldset>
                            </form>
                        </div>
                    </div>
                

                    <!-- {% comment %}Update Employee Form {% endcomment %} -->
                    {% cache 86400 cache_emp_modals%}
                    <div class="container empModalContainer" id="updateEmpDetailContainer">
                        <form id="updateEmployeeForm" method="post" class="container mt-5 mb-5" enctype="multipart/form-data">
                            {% csrf_token %}
                            <button type="button" class="close close-btn" data-dismiss="modal" aria-label="Close">
                                <span class="close openFlashMsg" aria-hidden="true"onclick="getElementById('updateEmpDetailContainer').style.display='none'">&times;</span>
                            </button>
                            <center><h4>Update Employee Data</h4></center>
                                <hr>
                                <section class="user_details profile-picture">
                                        <img class="profile_dp" id="profilePictureEditView" src="">
                                        <input class="profile-picture-input" data-empdata="true" type="file" name="profile-picture-file" accept="image/*">
                                        <div class="plus_container">
                                            <i class="fas fa-user-edit"></i>
                                        </div>
                                </section>    
                                <input type="hidden" id="eId" value="">
                            <fieldset>
                                <!-- Personal Information -->
                                <div class="personalInfoEdit">
                                    <legend><h4>Personal Details</h4></legend>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="firstNameEdit">First Name</label>
                                            <input type="text" id="firstNameEdit" name="first_name" class="form-control" required value="">
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="middleNameEdit">Middle Name</label>
                                            <input type="text" id="middleNameEdit" name="middle_name" class="form-control" value="">
                                        </div>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="lastNameEdit">Last Name</label>
                                            <input type="text" id="lastNameEdit" name="last_name" class="form-control" required value="">
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="phoneNumberEdit">Phone Number</label>
                                            <input type="text" id="phoneNumberEdit" name="phone_number" class="form-control" value="">
                                        </div>
                                    </div>

                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="emailEdit">Email</label>
                                            <input type="text" id="emailEdit" name="email" class="form-control" required value="">
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="addressEdit">Address</label>
                                            <input type="text" id="addressEdit" name="address" class="form-control" value="">
                                        </div>
                                    </div>

                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="dobEdit">Date of Birth</label>
                                            <input type="date" id="dobEdit" name="dob" class="form-control" value="">
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="genderEdit">Gender</label>
                                            <select class="form-control" id="genderEdit" name="gender" required>
                                                <option value="" disabled>Select</option>
                                                <option value="Male">Male</option>
                                                <option value="Female">Female</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="maritalStatusEdit">Marital Status</label>
                                            <select class="form-control" id="maritalStatusEdit" name="marital_status">
                                                <option value="" disabled>Select</option>
                                                <option value="Single">Single</option>
                                                <option value="Married">Married</option>
                                                <option value="Divorced">Divorced</option>
                                                <option value="Widowed">Widowed</option>
                                                <option value="Separated">Separated</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="nationalityEdit">Nationality</label>
                                            <select class="form-control" name="nationality" id="nationalityEdit">
                                                <option value="Afghanistan">Afghanistan</option>
                                                <option value="Albania">Albania</option>
                                                <option value="Algeria">Algeria</option>
                                                <option value="American Samoa">American Samoa</option>
                                                <option value="Andorra">Andorra</option>
                                                <option value="Angola">Angola</option>
                                                <option value="Anguilla">Anguilla</option>
                                                <option value="Antartica">Antarctica</option>
                                                <option value="Antigua and Barbuda">Antigua and Barbuda</option>
                                                <option value="Argentina">Argentina</option>
                                                <option value="Armenia">Armenia</option>
                                                <option value="Aruba">Aruba</option>
                                                <option value="Australia">Australia</option>
                                                <option value="Austria">Austria</option>
                                                <option value="Azerbaijan">Azerbaijan</option>
                                                <option value="Bahamas">Bahamas</option>
                                                <option value="Bahrain">Bahrain</option>
                                                <option value="Bangladesh">Bangladesh</option>
                                                <option value="Barbados">Barbados</option>
                                                <option value="Belarus">Belarus</option>
                                                <option value="Belgium">Belgium</option>
                                                <option value="Belize">Belize</option>
                                                <option value="Benin">Benin</option>
                                                <option value="Bermuda">Bermuda</option>
                                                <option value="Bhutan">Bhutan</option>
                                                <option value="Bolivia">Bolivia</option>
                                                <option value="Bosnia and Herzegowina">Bosnia and Herzegowina</option>
                                                <option value="Botswana">Botswana</option>
                                                <option value="Bouvet Island">Bouvet Island</option>
                                                <option value="Brazil">Brazil</option>
                                                <option value="British Indian Ocean Territory">British Indian Ocean Territory</option>
                                                <option value="Brunei Darussalam">Brunei Darussalam</option>
                                                <option value="Bulgaria">Bulgaria</option>
                                                <option value="Burkina Faso">Burkina Faso</option>
                                                <option value="Burundi">Burundi</option>
                                                <option value="Cambodia">Cambodia</option>
                                                <option value="Cameroon">Cameroon</option>
                                                <option value="Canada">Canada</option>
                                                <option value="Cape Verde">Cape Verde</option>
                                                <option value="Cayman Islands">Cayman Islands</option>
                                                <option value="Central African Republic">Central African Republic</option>
                                                <option value="Chad">Chad</option>
                                                <option value="Chile">Chile</option>
                                                <option value="China">China</option>
                                                <option value="Christmas Island">Christmas Island</option>
                                                <option value="Cocos Islands">Cocos (Keeling) Islands</option>
                                                <option value="Colombia">Colombia</option>
                                                <option value="Comoros">Comoros</option>
                                                <option value="Congo">Congo</option>
                                                <option value="Congo">Congo, the Democratic Republic of the</option>
                                                <option value="Cook Islands">Cook Islands</option>
                                                <option value="Costa Rica">Costa Rica</option>
                                                <option value="Cota D'Ivoire">Cote d'Ivoire</option>
                                                <option value="Croatia">Croatia (Hrvatska)</option>
                                                <option value="Cuba">Cuba</option>
                                                <option value="Cyprus">Cyprus</option>
                                                <option value="Czech Republic">Czech Republic</option>
                                                <option value="Denmark">Denmark</option>
                                                <option value="Djibouti">Djibouti</option>
                                                <option value="Dominica">Dominica</option>
                                                <option value="Dominican Republic">Dominican Republic</option>
                                                <option value="East Timor">East Timor</option>
                                                <option value="Ecuador">Ecuador</option>
                                                <option value="Egypt">Egypt</option>
                                                <option value="El Salvador">El Salvador</option>
                                                <option value="Equatorial Guinea">Equatorial Guinea</option>
                                                <option value="Eritrea">Eritrea</option>
                                                <option value="Estonia">Estonia</option>
                                                <option value="Ethiopia">Ethiopia</option>
                                                <option value="Falkland Islands">Falkland Islands (Malvinas)</option>
                                                <option value="Faroe Islands">Faroe Islands</option>
                                                <option value="Fiji">Fiji</option>
                                                <option value="Finland">Finland</option>
                                                <option value="France">France</option>
                                                <option value="France Metropolitan">France, Metropolitan</option>
                                                <option value="French Guiana">French Guiana</option>
                                                <option value="French Polynesia">French Polynesia</option>
                                                <option value="French Southern Territories">French Southern Territories</option>
                                                <option value="Gabon">Gabon</option>
                                                <option value="Gambia">Gambia</option>
                                                <option value="Georgia">Georgia</option>
                                                <option value="Germany">Germany</option>
                                                <option value="Ghana">Ghana</option>
                                                <option value="Gibraltar">Gibraltar</option>
                                                <option value="Greece">Greece</option>
                                                <option value="Greenland">Greenland</option>
                                                <option value="Grenada">Grenada</option>
                                                <option value="Guadeloupe">Guadeloupe</option>
                                                <option value="Guam">Guam</option>
                                                <option value="Guatemala">Guatemala</option>
                                                <option value="Guinea">Guinea</option>
                                                <option value="Guinea-Bissau">Guinea-Bissau</option>
                                                <option value="Guyana">Guyana</option>
                                                <option value="Haiti">Haiti</option>
                                                <option value="Heard and McDonald Islands">Heard and Mc Donald Islands</option>
                                                <option value="Holy See">Holy See (Vatican City State)</option>
                                                <option value="Honduras">Honduras</option>
                                                <option value="Hong Kong">Hong Kong</option>
                                                <option value="Hungary">Hungary</option>
                                                <option value="Iceland">Iceland</option>
                                                <option value="India">India</option>
                                                <option value="Indonesia">Indonesia</option>
                                                <option value="Iran">Iran (Islamic Republic of)</option>
                                                <option value="Iraq">Iraq</option>
                                                <option value="Ireland">Ireland</option>
                                                <option value="Israel">Israel</option>
                                                <option value="Italy">Italy</option>
                                                <option value="Jamaica">Jamaica</option>
                                                <option value="Japan">Japan</option>
                                                <option value="Jordan">Jordan</option>
                                                <option value="Kazakhstan">Kazakhstan</option>
                                                <option value="Kenya">Kenya</option>
                                                <option value="Kiribati">Kiribati</option>
                                                <option value="Democratic People's Republic of Korea">Korea, Democratic People's Republic of</option>
                                                <option value="Korea">Korea, Republic of</option>
                                                <option value="Kuwait">Kuwait</option>
                                                <option value="Kyrgyzstan">Kyrgyzstan</option>
                                                <option value="Lao">Lao People's Democratic Republic</option>
                                                <option value="Latvia">Latvia</option>
                                                <option value="Lebanon" selected>Lebanon</option>
                                                <option value="Lesotho">Lesotho</option>
                                                <option value="Liberia">Liberia</option>
                                                <option value="Libyan Arab Jamahiriya">Libyan Arab Jamahiriya</option>
                                                <option value="Liechtenstein">Liechtenstein</option>
                                                <option value="Lithuania">Lithuania</option>
                                                <option value="Luxembourg">Luxembourg</option>
                                                <option value="Macau">Macau</option>
                                                <option value="Macedonia">Macedonia, The Former Yugoslav Republic of</option>
                                                <option value="Madagascar">Madagascar</option>
                                                <option value="Malawi">Malawi</option>
                                                <option value="Malaysia">Malaysia</option>
                                                <option value="Maldives">Maldives</option>
                                                <option value="Mali">Mali</option>
                                                <option value="Malta">Malta</option>
                                                <option value="Marshall Islands">Marshall Islands</option>
                                                <option value="Martinique">Martinique</option>
                                                <option value="Mauritania">Mauritania</option>
                                                <option value="Mauritius">Mauritius</option>
                                                <option value="Mayotte">Mayotte</option>
                                                <option value="Mexico">Mexico</option>
                                                <option value="Micronesia">Micronesia, Federated States of</option>
                                                <option value="Moldova">Moldova, Republic of</option>
                                                <option value="Monaco">Monaco</option>
                                                <option value="Mongolia">Mongolia</option>
                                                <option value="Montserrat">Montserrat</option>
                                                <option value="Morocco">Morocco</option>
                                                <option value="Mozambique">Mozambique</option>
                                                <option value="Myanmar">Myanmar</option>
                                                <option value="Namibia">Namibia</option>
                                                <option value="Nauru">Nauru</option>
                                                <option value="Nepal">Nepal</option>
                                                <option value="Netherlands">Netherlands</option>
                                                <option value="Netherlands Antilles">Netherlands Antilles</option>
                                                <option value="New Caledonia">New Caledonia</option>
                                                <option value="New Zealand">New Zealand</option>
                                                <option value="Nicaragua">Nicaragua</option>
                                                <option value="Niger">Niger</option>
                                                <option value="Nigeria">Nigeria</option>
                                                <option value="Niue">Niue</option>
                                                <option value="Norfolk Island">Norfolk Island</option>
                                                <option value="Northern Mariana Islands">Northern Mariana Islands</option>
                                                <option value="Norway">Norway</option>
                                                <option value="Oman">Oman</option>
                                                <option value="Pakistan">Pakistan</option>
                                                <option value="Palau">Palau</option>
                                                <option value="Panama">Panama</option>
                                                <option value="Papua New Guinea">Papua New Guinea</option>
                                                <option value="Paraguay">Paraguay</option>
                                                <option value="Peru">Peru</option>
                                                <option value="Philippines">Philippines</option>
                                                <option value="Pitcairn">Pitcairn</option>
                                                <option value="Poland">Poland</option>
                                                <option value="Portugal">Portugal</option>
                                                <option value="Puerto Rico">Puerto Rico</option>
                                                <option value="Qatar">Qatar</option>
                                                <option value="Reunion">Reunion</option>
                                                <option value="Romania">Romania</option>
                                                <option value="Russia">Russian Federation</option>
                                                <option value="Rwanda">Rwanda</option>
                                                <option value="Saint Kitts and Nevis">Saint Kitts and Nevis</option> 
                                                <option value="Saint LUCIA">Saint LUCIA</option>
                                                <option value="Saint Vincent">Saint Vincent and the Grenadines</option>
                                                <option value="Samoa">Samoa</option>
                                                <option value="San Marino">San Marino</option>
                                                <option value="Sao Tome and Principe">Sao Tome and Principe</option> 
                                                <option value="Saudi Arabia">Saudi Arabia</option>
                                                <option value="Senegal">Senegal</option>
                                                <option value="Seychelles">Seychelles</option>
                                                <option value="Sierra">Sierra Leone</option>
                                                <option value="Singapore">Singapore</option>
                                                <option value="Slovakia">Slovakia (Slovak Republic)</option>
                                                <option value="Slovenia">Slovenia</option>
                                                <option value="Solomon Islands">Solomon Islands</option>
                                                <option value="Somalia">Somalia</option>
                                                <option value="South Africa">South Africa</option>
                                                <option value="South Georgia">South Georgia and the South Sandwich Islands</option>
                                                <option value="Span">Spain</option>
                                                <option value="SriLanka">Sri Lanka</option>
                                                <option value="St. Helena">St. Helena</option>
                                                <option value="St. Pierre and Miguelon">St. Pierre and Miquelon</option>
                                                <option value="Sudan">Sudan</option>
                                                <option value="Suriname">Suriname</option>
                                                <option value="Svalbard">Svalbard and Jan Mayen Islands</option>
                                                <option value="Swaziland">Swaziland</option>
                                                <option value="Sweden">Sweden</option>
                                                <option value="Switzerland">Switzerland</option>
                                                <option value="Syria">Syrian Arab Republic</option>
                                                <option value="Taiwan">Taiwan, Province of China</option>
                                                <option value="Tajikistan">Tajikistan</option>
                                                <option value="Tanzania">Tanzania, United Republic of</option>
                                                <option value="Thailand">Thailand</option>
                                                <option value="Togo">Togo</option>
                                                <option value="Tokelau">Tokelau</option>
                                                <option value="Tonga">Tonga</option>
                                                <option value="Trinidad and Tobago">Trinidad and Tobago</option>
                                                <option value="Tunisia">Tunisia</option>
                                                <option value="Turkey">Turkey</option>
                                                <option value="Turkmenistan">Turkmenistan</option>
                                                <option value="Turks and Caicos">Turks and Caicos Islands</option>
                                                <option value="Tuvalu">Tuvalu</option>
                                                <option value="Uganda">Uganda</option>
                                                <option value="Ukraine">Ukraine</option>
                                                <option value="United Arab Emirates">United Arab Emirates</option>
                                                <option value="United Kingdom">United Kingdom</option>
                                                <option value="United States">United States</option>
                                                <option value="United States Minor Outlying Islands">United States Minor Outlying Islands</option>
                                                <option value="Uruguay">Uruguay</option>
                                                <option value="Uzbekistan">Uzbekistan</option>
                                                <option value="Vanuatu">Vanuatu</option>
                                                <option value="Venezuela">Venezuela</option>
                                                <option value="Vietnam">Viet Nam</option>
                                                <option value="Virgin Islands (British)">Virgin Islands (British)</option>
                                                <option value="Virgin Islands (U.S)">Virgin Islands (U.S.)</option>
                                                <option value="Wallis and Futana Islands">Wallis and Futuna Islands</option>
                                                <option value="Western Sahara">Western Sahara</option>
                                                <option value="Yemen">Yemen</option>
                                                <option value="Serbia">Serbia</option>
                                                <option value="Zambia">Zambia</option>
                                                <option value="Zimbabwe">Zimbabwe</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="stateOfOriginEdit">State Of Origin</label>
                                            <input type="text" class="form-control" id="stateOfOriginEdit" name="state_of_origin">
                                        </div>
                                        <!-- profile picture -->
                                        <div class="form-group col-md-6">
                                            <label for="profilePictureEdit"> Employee Profile Picture</label>
                                            <div class="form-control custom-file" style="border:0">
                                                    <input type="file" name="profile_picture" class="custom-file-input" id="profilePictureEdit">
                                                    <label class="custom-file-label text-truncate" for="profilePictureEdit">---</label>
                                                    <script type="text/javascript" id="script-profilePictureEdit">        
                                                    document.getElementById("script-profilePictureEdit").parentNode.querySelector('.custom-file-input').onchange =  function (e){
                                                    var filenames = "";
                                                    for (let i=0;i<e.target.files.length;i++){
                                                        filenames+=(i>0?", ":"")+e.target.files[i].name;
                                                    }
                                                    e.target.parentNode.querySelector('.custom-file-label').textContent=filenames;    
                                                    }        
                                                </script> 
                                            </div> 
                                        </div>
                                    </div>
                                </div>
                            </fieldset>

                            {% comment %} Bank detail {% endcomment %}
                            <fieldset>
                                <legend><h4>Bank Details</h4></legend>
                                <div class="bankDetail">
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="bankNameEdit">Bank Name</label>
                                            <input type="text" id="bankNameEdit" name="bank_name" class="form-control" value="">
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="accountNumberEdit">Account Number</label>
                                            <input type="text" id="accountNumberEdit" name="account_number" class="form-control" value="">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="accountNameEdit">Account Name</label>
                                            <input type="text" id="accountNameEdit" name="account_name" class="form-control" value="">
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="pensionIdEdit">Pension ID</label>
                                            <input type="text" id="pensionIdEdit" name="pension_id" class="form-control" value="">
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                                <!-- Employment Information -->

                            <fieldset>
                                <legend><h4>Work Details</h4></legend>
                                <div class="employmentInfoEdit">
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="employeeIdEdit">EmployeeID</label>
                                            <input type="text" id="employeeIdEdit" name="employee_id" class="form-control" required value="">
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="departmentEdit">Department</label>
                                            <input type="text" id="departmentEdit" name="department" class="form-control" required value="">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="jobRoleEdit">Job Role</label>
                                            <input type="text" id="jobRoleEdit" name="job_role" class="form-control" value="" required>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="joiningDateEdit">Date Joined</label>
                                            <input type="date" id="joiningDateEdit" name="joining_date" class="form-control" value="">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="employmentTypeEdit">Employment Type</label>
                                            <select id="employmentTypeEdit" name="employment_type" class="form-control" required>
                                                <option value="" disabled>--Select--</option>
                                                <option value="Full-time"> Full-time</option>
                                                <option value="Part-time"> Part-time</option>
                                                <option value="Contract"> Contract</option>
                                                <option value="Intern"> Intern</option>
                                                <option value="Volunteer"> Volunteer</option>
                                                <option value="Temporary"> Temporary</option>
                                                <option value="Seasonal"> Seasonal</option>
                                                <option value="Freelance"> Freelance</option>
                                                <option value="Remote"> Remote</option>
                                                <option value="Disabled"> Disabled</option>
                                                <option value="Other"> Other</option>
                                            </select>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="employmentStatusEdit">Employment Status</label>
                                            <select id="employmentStatusEdit" name="employment_status" class="form-control" required>
                                                <option value="">Select Employment Status</option>
                                                <option value="Active"> Active</option>
                                                <option value="Inactive"> Inactive</option>
                                                <option value="Suspended"> Suspended</option>
                                                <option value="Terminated"> Terminated</option>
                                                <option value="Resigned"> Resigned</option>
                                                <option value="Retired"> Retired</option>
                                                <option value="Deceased"> Deceased</option>
                                                <option value="On Leave"> On Leave</option>
                                                <option value="On Training"> On Training</option>
                                                <option value="On Probation"> On Probation</option>
                                                <option value="Other"> Other</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="designationEdit">Designation</label>
                                            <select id="designationEdit" name="designation" class="form-control" required>
                                                <option value="">Select Designation</option>
                                                <option value="Employee"> Employee</option>
                                                <option value="Intern"> Intern</option>
                                                <option value="Trainee"> Trainee</option>
                                                <option value="Associate"> Associate</option>
                                                <option value="Assistant"> Assistant</option>
                                                <option value="Officer"> Officer</option>
                                                <option value="Analyst"> Analyst</option>
                                                <option value="Coordinator"> Coordinator</option>
                                                <option value="Specialist"> Specialist</option>
                                                <option value="Consultant"> Consultant</option>
                                                <option value="Advisor"> Advisor</option>
                                                <option value="Supervisor"> Supervisor</option>
                                                <option value="Manager"> Manager</option>
                                                <option value="Director"> Director</option>
                                                <option value="Executive"> Executive</option>
                                                <option value="President"> President</option>
                                                <option value="CEO"> CEO</option>
                                                <option value="CFO"> CFO</option>
                                                <option value="CTO"> CTO</option>
                                                <option value="CIO"> CIO</option>
                                                <option value="COO"> COO</option>
                                                <option value="Chairman"> Chairman</option>
                                                <option value="Board Member"> Board Member</option>
                                                <option value="Other"> Other</option>
                                            </select>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="levelEdit">Level</label>
                                            <select id="levelEdit" name="level" class="form-control">
                                                <option value="" disabled>Select</option>
                                                <option value="Entry-level">Entry-level</option>
                                                <option value="Mid-level">Mid-level</option>
                                                <option value="Senior-level">Senior-level</option>
                                                <option value="Executive">Executive</option>
                                                <option value="Top-level">Top-level</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="lastPromotionDateEdit">Last Promotion Date</label>
                                            <input type="date" id="lastPromotionDateEdit" name="last_promotion_date" class="form-control" value="">
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="nextPromotionDateEdit">Next Promotion Date</label>
                                            <input type="date" id="nextPromotionDateEdit" name="next_promotion_date" class="form-control" value="">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="highestQualificationEdit">Highest Qualification</label>
                                            <input type="text" id="highestQualificationEdit" name="highest_qualification" class="form-control" value="">
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="salaryEdit">Salary</label>
                                            <input type="number" id="salaryEdit" name="basic_salary" class="form-control" value="">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="terminationResignationDateEdit">Termination/Resignation Date</label>
                                            <input type="date" id="terminationResignationDateEdit" name="termination_resignation_date" class="form-control" value="">
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="emergencyContactsEdit">Emergency Contacts</label>
                                            <textarea id="emergencyContactsEdit" name="emergency_contacts" class="form-control" required></textarea>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="highestCertificateEdit">Highest Certificate</label>
                                            <div style="border:0" class="form-control custom-file"> 
                                                <input type="file" name="highest_certificate" id="highestCertificateEdit" class="custom-fle-input"> <label class="custom-file-label text-truncate" for="highestCertificateEdit"></label> 
                                                <script type="text/javascript" id="script-highestCertificateEdit">        
                                                document.getElementById("script-highestCertificateEdit").parentNode.querySelector('.custom-file-input').onchange =  function (e){
                                                    var filenames = "";
                                                    for (let i=0;i<e.target.files.length;i++){
                                                        filenames+=(i>0?", ":"")+e.target.files[i].name;
                                                    }
                                                    e.target.parentNode.querySelector('.custom-file-label').textContent=filenames;    
                                                }        
                                            </script>
                                            </div> 
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="employmentLetterEdit">Employment Letter</label>
                                            <div style="border:0" class="form-control custom-file"> 
                                                <input type="file" name="employment_letter" id="employmentLetterEdit" class="custom-fle-input"> <label class="custom-file-label text-truncate" for="employmentLetterEdit"></label> 
                                                <script type="text/javascript" id="script-employmentLetterEdit">        
                                                document.getElementById("script-employmentLetterEdit").parentNode.querySelector('.custom-file-input').onchange =  function (e){
                                                    var filenames = "";
                                                    for (let i=0;i<e.target.files.length;i++){
                                                        filenames+=(i>0?", ":"")+e.target.files[i].name;
                                                    }
                                                    e.target.parentNode.querySelector('.custom-file-label').textContent=filenames;    
                                                }        
                                            </script>
                                            </div> 
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="supervisedEmployeesEdit">Supervised Employees</label>
                                            <select id="supervisedEmployeesEdit" name="supervised_employees" class="form-control" multiple>
                                                <option value="" disabled>Select</option>
                                            </select>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="skillsQualificationsEdit">Other Comments</label>
                                            <textarea id="skillsQualificationsEdit" name="skills_qualifications" class="form-control"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>

                                <!-- Next of Kin -->
                            <fieldset>
                                <legend><h4>Next of Kin</h4></legend>
                                <div class="nextOfKinEdit">
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="taxIdEdit">Tax ID</label>
                                            <input type="text" id="taxIdEdit" name="tax_id" class="form-control" value="">
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="nextOfKinNameEdit">Next of Kin Name</label>
                                            <input type="text" id="nextOfKinNameEdit" name="next_of_kin_name" class="form-control" value="">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="nextOfKinRelationshipEdit">Relationship</label>
                                            <select id="nextOfKinRelationshipEdit" name="next_of_kin_relationship" class="form-control">
                                                <option value="" disabled>Select</option>
                                                <option value="Spouse">Spouse</option>
                                                <option value="Child">Child</option>
                                                <option value="Parent">Parent</option>
                                                <option value="Sibling">Sibling</option>
                                                <option value="Relative">Relative</option>
                                                <option value="Friend">Friend</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="nextOfKinPhoneNumberEdit">Phone Number</label>
                                            <input type="tel" id="nextOfKinPhoneNumberEdit" name="next_of_kin_phone_number" class="form-control" value="">
                                        </div>
                                    </div>
                                </div>
                            </fieldset>

                            {% comment %} submit button div {% endcomment %}
                            <div class="btnHandle">
                                <button type="button" class="btn btn-primary cancelBtn" id="cancelBtn" style="background-color: red;">Cancel</button>
                                <button type="submit" class="btn btn-primary" id="updateEmployeeBtn">Update</button>
                            </div>
                        </form>
                    </div>

                    {% comment %} Archive Employee  {% endcomment %}
                    <div id="unarchive-modal" class="archive-modal">
                        <div class="modal-content">
                            <center>
                                <h5>Proceed to restore this employee?</h5>
                            <div class="flex-buttton">
                                <button type="submit" id="submitRestoreBtn" class="restore-submit-btn btn btn-primary">Yes</button>
                                <button type="button" onclick="getElementById('unarchive-modal').style.display='none'" class="btn btn-danger close-btn">No</button>
                            </div>
                        </center>
                        </div>
                    </div>

                    {% comment %} Archive Employee  from{% endcomment %}
                    <div id="archive-modal" class="archive-modal">
                        <div class="modal-content">
                            <span class="close" aria-hidden="true" onclick="getElementById('archive-modal').style.display='none'">&times;</span>
                        <center>
                            <h4>Archive Employee</h4>
                            <form id="archiveEmployeeForm" method="post">
                                {% csrf_token %}
                                <div class="form-group">
                                <label for="a-reason">Reason for Archival:</label>
                                <textarea class="form-control" id="a-reason" name="reason" rows="4" cols="50"></textarea>
                                </div>
                                <div class="">
                                    <button type="submit" id="submitArchiveBtn" class="archive-submit-btn btn btn-primary">Confirm</button>
                                    <button type="button" onclick="getElementById('archive-modal').style.display='none'" class="btn btn-danger close-btn">Cancel</button>
                                </div>
                            </form>
                        </center>
                        </div>


                    </div>

                    {% comment %} Delete Employee {% endcomment %}
                    <div id="delete-modal" class="archive-modal">
                        <div class="modal-content">
                            <center>
                                <h5>Proceed to <b>delete</b> this employee?</h5>
                                <p>This action cannot be undone. Consider archiving instead</p>
                            <div class="flex-buttton">
                                <button type="submit" id="submitDeleteBtn" class="delete-submit-btn btn btn-primary">Delete</button>
                                <button type="submit" id="submitArchiveBtnDel" class="archive-submit-btn btn btn-primary">Archive</button>
                                <button type="button" onclick="getElementById('delete-modal').style.display='none'" class="btn btn-danger close-btn">Cancel</button>
                            </div>
                        </center>
                        </div>
                    </div>

                    <div id="archive-modal2" class="archive-modal">
                        <div class="modal-content">
                            <span class="close" aria-hidden="true" onclick="getElementById('archive-modal2').style.display='none'">&times;</span>
                            <center>
                                <h4>Archive Employee</h4>
                                <form id="archiveEmployeeForm2" method="post">
                                    {% csrf_token %}
                                    <div class="form-group">
                                    <label for="rsn">Reason for Archival:</label>
                                    <textarea class="form-control" id="rsn" name="reason" rows="4" cols="50"></textarea>
                                    </div>
                                    <div class="">
                                        <button type="submit" id="submitArchiveBtn2" class="archive-submit-btn btn btn-primary">Confirm</button>
                                        <button type="button" onclick="getElementById('archive-modal2').style.display='none'" class="btn btn-danger close-btn">Cancel</button>
                                    </div>
                                </form>
                            </center>
                        </div>
                    </div>
                    {% endcache %}
                </div>
                
                
                {% comment %} Leave management {% endcomment %}
                <div class="leave-management mgt">
                    {% cache 86400 leaveToggle%}
                    <div class="menuToggle">
                        <h3 class="hidePrint">Manage Leaves</h3> <span class="menu-toggle-icon"><i class="fas fa-bars"></i></span>
                    </div>
                
                    <div class="leave-navigation actions">
                        <div class="fgroup">
                            <button class="tab2 nav-tab active" data-tab2="leave-requests"><i class="fas fa-list-alt"></i> Requests </button>
                            <button class="tab2 nav-tab" data-tab2="apply-leave"><i class="fas fa-file-signature"></i> Apply </button>
                        </div>
                        <div class="fgroup">
                            <button class="tab2 nav-tab" data-tab2="active-leave"><i class="fas fa-check-circle"></i> Active </button>
                            <button class="tab2 nav-tab" data-tab2="leave-history"><i class="fas fa-history"></i> History </button>
                        </div>
                        <div class="fgroup">
                            <button class="tab2 nav-tab stretch" data-tab2="leave-statistics"><i class="fas fa-chart-bar"></i> Stats </button>
                        </div>
                    </div>
                    {% endcache %}

                    {% comment %} Apply for Leave {% endcomment %}
                    <div class="tab-contents2" id="apply-leave">
                            <h4>Apply for Leave</h4>
                            <form method="post" action="{% url 'leave_request' %}">
                                {% csrf_token %}
                                <table class="apply-leave table">
                                    <input type="hidden" name="branch_id" value="{{ branch_id }}">
                                    <tr>
                                        <th colspan="2">Leave Request Form</th>
                                    </tr>
                                    <tr>
                                        <td><label for="employeeName">Employee:</label></td>
                                        <td>
                                            <select id="employeeName" name="employee_id">
                                                <option value="" disabled selected>Select</option>
                                                {% for employee in employees %}
                                                <option value="{{ employee.employee_id }}">{{ employee.first_name }} {{ employee.last_name }}</option>
                                                {% endfor %}
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><label for="employeeID">Employee ID:<span class="asteriskField">*</span></label></td>
                                        <td><input type="text" id="employeeID" name="employee_id" required></td>
                                    <tr>
                                        <td><label for="leaveType">Leave Type:<span class="asteriskField">*</span></label></td>
                                        <td><select id="leaveType" name="leave_type" required>
                                                <option value="--Select--">--Select--</option>
                                                <option value="Annual">Annual</option>
                                                <option value="Vacation">Vacation</option>
                                                <option value="Sick">Sick</option>
                                                <option value="Maternity">Maternity</option>
                                                <option value="Paternity">Paternity</option>
                                                <option value="Bereavement">Bereavement</option>
                                                <option value="Compassionate">Compassionate</option>
                                                <option value="Study">Study</option>
                                                <option value="Unpaid">Unpaid</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><label for="rmk">Remark: </label></td>
                                        <td><textarea id="rmk" name="reason" placeholder="Reason for leave"></textarea></td>
                                        <tr>
                                            <td><label for="startDate">Start Date:<span class="asteriskField">*</span></label></td>
                                            <td><input type="date" id="startDate" name="start_date" max="{{ today }}" value="{{ today|date:'Y-m-d' }}" required></td>
                                        </tr>
                                        <tr>
                                            <td><label for="endDate">End Date:<span class="asteriskField">*</span></label></td>
                                            <td><input type="date" id="endDate" name="end_date" min="{{ today }}" required></td>
                                        </tr>
                                    <tr>
                                        <td colspan="2"><div class="btnHandle"><button type="submit">Submit</button></div></td>
                                    </tr>
                                </table>
                            </form>
                    </div> 
                
                    {% comment %} Leave Request {% endcomment %}
                    <div class="tab-contents2" id="leave-requests">
                        <!-- Leave Requests content -->
                        {% if pending_leave_requests %}
                        <div class="searchFlex">
                            <h4>Leave Requests</h4> <button class="btn btn-primary" onclick="window.print()">Print</button>
                        </div>
                        <table class="dataTable">
                            <thead>
                                <tr>
                                    <th>SN</th>
                                    <th>Employee</th>
                                    <th>Type</th>
                                    <th>Start Date</th>
                                    <th>End Date</th>
                                    <th>Status</th>
                                    <th class="expand-width">Action</th>
                                </tr>
                            </thead>
                            <tbody class="employee-table-body">
                                {% for leave in pending_leave_requests %}
                                <tr class="s-card">
                                    <td>{{ forloop.counter }}</td>
                                    <td class="sf1">{{ leave.employee.first_name }} {{ leave.employee.last_name }} </td>
                                    <td>{{ leave.leave_type }}</td>
                                    <td>{{ leave.leave_start_date|date:'d/m/y' }}</td>
                                    <td>{{ leave.leave_end_date|date:'d/m/y' }}</td>
                                    <td class="sf2">{{ leave.leave_status }}</td>
                                    <td class="controlButton">
                                        <button class="approve-btn approve" data-leaveid="{{ leave.pk }}">Approve</button>
                                        <button class="decline-btn reject" data-leaveid="{{ leave.pk }}">Decline</button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <center>
                            <h4>No leave requests yet</h4>
                            <p>Leave requests will be displayed here</p>
                        </center>
                        {% endif %}                        
                    </div>
                    
                    {% comment %} Active Leave List {% endcomment %}
                    <div class="tab-contents2 view-leave-list" id="active-leave">
                        {% if active_leave %}
                        <div class="searchFlex">
                            <h4>Active Leave</h4> <button class="btn btn-primary" onclick="window.print()">Print</button>
                        </div>
                        <table class="dataTable">
                            <thead>
                                <tr>
                                    <th>SN</th>
                                    <th>ID</th>
                                    <th>Full Name</th>
                                    <th>Leave Type</th>
                                    <th>Start Date</th>
                                    <th>End Date</th>
                                </tr>
                            </thead>
                            <tbody class="employee-table-body">
                                {% for leave in active_leave %}
                                <tr class="s-card">
                                    <td>{{ forloop.counter }}</td>
                                    <td class="sf2">{{ leave.employee.employee_id }}</td>
                                    <td class="sf1">{{ leave.employee.first_name }} {{ leave.employee.last_name }}</td>
                                    <td>{{ leave.leave_type }}</td>
                                    <td>{{ leave.leave_start_date|date:'d/m/y' }}</td>
                                    <td>{{ leave.leave_end_date|date:'d/m/y' }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <center>
                            <h4>No employee on leave</h4>
                            <p>Employees on leave will be displayed here</p>
                        </center>
                        {% endif %}
                    </div>

                    {% comment %} Leave History {% endcomment %}
                    <div class="tab-contents2" id="leave-history">
                        {% if leave_history %}
                        <div class="searchFlex">
                            <h4>Leave History</h4> <button class="btn btn-primary" onclick="window.print()">Print</button>
                        </div>
                        <table class="dataTable leave-history-table apply-leave">
                            <thead>
                                <tr>
                                    <th>SN</th>
                                    <th>ID</th>
                                    <th>Employee</th>
                                    <th>Type</th>
                                    <th>Start Date</th>
                                    <th>End Date</th>
                                </tr>
                            </thead>
                            <tbody class="employee-table-body">
                                {% for leave in leave_history %}
                                <tr class="s-card">
                                    <td>{{ forloop.counter }}</td>
                                    <td class="sf2">{{ leave.employee.employee_id }}</td>
                                    <td class="sf1">{{ leave.employee.first_name }} {{ leave.employee.last_name }}</td>
                                    <td>{{ leave.leave_type }}</td>
                                    <td>{{ leave.leave_start_date|date:'d/m/y' }}</td>
                                    <td>{{ leave.leave_end_date|date:'d/m/y' }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <center>
                            <h4>No leave history yet</h4>
                            <p>Leave history will be displayed here</p>
                        </center>
                        {% endif %}
                    </div>
                
                    {% comment %} Leave Statistics {% endcomment %}
                    <div class="tab-contents2 statistics" id="leave-statistics">
                        <h3>Leave Statistics</h3>
                        <div class="statistics-grid">
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="statistic-info">
                                    <h3>Total Employees</h3>
                                    {% if total_employees_count is not None %}
                                    <p class="statsVal">{{ total_employees_count|intcomma }}</p>
                                    {% else %}
                                    <p class="statsVal" style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <div class="statistic-info">
                                    <h3>Total Leave Requests</h3>
                                    {% if leave_requests is not None %}
                                    <p class="statsVal">{{ leave_requests.count|intcomma }}</p>
                                    {% else %}
                                    <p class="statsVal" style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                    <i class="fas fa-calendar-check goodStat"></i>
                                </div>
                                <div class="statistic-info">
                                    <h3>Approved Leave Requests</h3>
                                    {% if approved_leave_requests is not None %}
                                    <p class="statsVal">{{ approved_leave_requests|intcomma }}</p>
                                    {% else %}
                                    <p class="statsVal" style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                    <i class="fas fa-calendar-times badStat"></i>
                                </div>
                                <div class="statistic-info">
                                    <h3>Pending Leave Requests</h3>
                                    {% if pending_leave_requests is not None %}
                                    <p class="statsVal">{{ pending_leave_requests.count|intcomma }}</p>
                                    {% else %}
                                    <p class="statsVal" style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                    <i class="fas fa-calendar-day"></i>
                                </div>
                                <div class="statistic-info">
                                    <h3>Average Leave Duration</h3>
                                    {% if average_leave_duration is not None %}
                                    <p class="statsVal">{{ average_leave_duration |floatformat:"2"|intcomma }} days</p>
                                    {% else %}
                                    <p class="statsVal" style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="statistic-info">
                                    <h3>Leave Trends</h3>
                                    <p>Upward trend in leave requests</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                {% comment %} Payroll {% endcomment %}
                <div class="payroll-management mgt">
                    <div class="menuToggle">
                        <h3 class="hidePrint">Manage Payrolls</h3> <span class="menu-toggle-icon"><i class="fas fa-bars"></i></span>
                    </div>
                
                    <div class="payroll-navigation actions">
                        <div class="fgroup">
                            <button class="tab3 nav-tab active" data-tab3="create-payroll"><i class="fas fa-plus-circle"></i> Create</button>
                            <button class="tab3 nav-tab" data-tab3="payroll-list"><i class="fas fa-list"></i> List</button>
                        </div>
                        <div class="fgroup">
                            <button class="tab3 nav-tab" data-tab3="bank-info"><i class="fas fa-university"></i> Bank Info</button>
                            <button class="tab3 nav-tab" data-tab3="payroll-statistics"><i class="fas fa-chart-pie"></i> Statistics</button>
                        </div>
                    </div>
                    
                    {% comment %} Create Payroll {% endcomment %}
                    <div class="tab-contents3" id="create-payroll">
                        <div class="createPayRollForm">
                            <div class="searchFlex">
                                <h4>Create Payroll</h4> <button class="btn btn-primary" id="uploadPRollBtn">Upload Excel or CSV file</button>
                            </div>   
                            <form method="POST" action="{% url 'create_payroll' %}" >
                                {% csrf_token %}
                                <div class="row">
                                    <div class="col-md-12">
                                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                                            <li class="nav-item">
                                                <a class="nav-link active" id="basic-info-tab" data-toggle="tab" href="#basic-info" role="tab" aria-controls="basic-info" aria-selected="true">Basic Information</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" id="allowances-tab" data-toggle="tab" href="#allowances" role="tab" aria-controls="allowances" aria-selected="false">Allowances</a>
                                            </li>
                                            
                                            <li class="nav-item">
                                                <a class="nav-link" id="deductions-tab" data-toggle="tab" href="#deductions" role="tab" aria-controls="deductions" aria-selected="false">Deductions</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" id="bonuses-tab" data-toggle="tab" href="#bonuses" role="tab" aria-controls="bonuses" aria-selected="false">Bonuses</a>
                                            </li>
                                        </ul>
                                        <div class="tab-content" id="myTabContent">
                                            {% comment %} basic info employee_id, month, year, basic_salary {% endcomment %}
                                            <div class="tab-pane fade show active" id="basic-info" role="tabpanel" aria-labelledby="basic-info-tab">
                                                <div class="form-row">
                                                    <div class="form-group col-md-6">
                                                        <label for="employee_id">Employee ID:<span class="asteriskField">*</span></label>
                                                        <input type="text" id="employee_id" name="employee_id" class="form-control" required>
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="month">Month:<span class="asteriskField">*</span></label>
                                                        <select id="month" name="month" class="form-control" required>
                                                            <option value="" disabled selected>--Select--</option>
                                                            <option value="1"> January</option>
                                                            <option value="2"> February</option>
                                                            <option value="3"> March</option>
                                                            <option value="4"> April</option>
                                                            <option value="5"> May</option>
                                                            <option value="6"> June</option>
                                                            <option value="7"> July</option>
                                                            <option value="8"> August</option>
                                                            <option value="9"> September</option>
                                                            <option value="10"> October</option>
                                                            <option value="11"> November</option>
                                                            <option value="12"> December</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="form-row">
                                                    <div class="form-group col-md-6">
                                                        <label for="year">Year:<span class="asteriskField">*</span></label>
                                                        <input type="number" id="year" name="year" class="form-control"  value="{{ payroll.first.year}}" required>
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="basic_salary">Basic Salary:<span class="asteriskField">*</span></label>
                                                        <input type="number" id="basic_salary" name="basic_salary" class="form-control" required>
                                                    </div>
                                                </div>
                                            </div>
                                            {% comment %} allowances housing, transport, feeding, utility, other {% endcomment %}
                                            <div class="tab-pane fade" id="allowances" role="tabpanel" aria-labelledby="allowances-tab">
                                                <div class="form-row">
                                                    <div class="form-group col-md-6">
                                                        <label for="housing_allowance">Housing Allowance:<span class="asteriskField">*</span></label>
                                                        <input type="number" id="housing_allowance" name="housing_allowance" class="form-control" value="0" required>
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="transport_allowance">Transport Allowance:<span class="asteriskField">*</span></label>
                                                        <input type="number" id="transport_allowance" name="transport_allowance" class="form-control" value="0" required>
                                                    </div>
                                                </div>
                                                <div class="form-row">
                                                    <div class="form-group col-md-6">
                                                        <label for="feeding_allowance">Feeding Allowance:<span class="asteriskField">*</span></label>
                                                        <input type="number" id="feeding_allowance" name="feeding_allowance" class="form-control" value="0" required>
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="utility_allowance">Utility Allowance:<span class="asteriskField">*</span></label>
                                                        <input type="number" id="utility_allowance" name="utility_allowance" class="form-control" value="0" required>
                                                    </div>
                                                </div>
                                                <div class="form-row">
                                                    <div class="form-group col-md-6">
                                                        <label for="other_allowance">Other Allowance:<span class="asteriskField">*</span></label>
                                                        <input type="number" id="other_allowance" name="other_allowance" class="form-control" value="0" required>
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="late_penalty">Late Penalty:<span class="asteriskField">*</span></label>
                                                        <input type="number" id="late_penalty" name="late_penalty" class="form-control" value="0" required>
                                                    </div>            
                                                </div>
                                            </div>
                                            {% comment %} deductions tax, peinsion, loan, others {% endcomment %}
                                            <div class="tab-pane fade" id="deductions" role="tabpanel" aria-labelledby="deductions-tab">                    
                                                <div class="form-row">
                                                    <div class="form-group col-md-6">
                                                        <label for="tax">Tax:<span class="asteriskField">*</span></label>
                                                        <input type="number" id="tax" name="tax" class="form-control" value="0" required>
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="pension">Pension:<span class="asteriskField">*</span></label>
                                                        <input type="number" id="pension" name="pension" class="form-control" value="0" required>
                                                    </div>
                                                </div>
                
                                                <div class="form-row">
                                                    <div class="form-group col-md-6">
                                                        <label for="loan">Loan:<span class="asteriskField">*</span></label>
                                                        <input type="number" id="loan" name="loan" class="form-control" value="0" required>
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="other_deductions">Other Deductions:<span class="asteriskField">*</span></label>
                                                        <input type="number" id="other_deductions" name="other_deductions" class="form-control" value="0" required>
                                                    </div>
                                                </div>
                                                <div class="form-row">
                                                    <div class="form-group col-md-6">
                                                        <label for="absent_penalty">Absent Penalty:<span class="asteriskField">*</span></label>
                                                        <input type="number" id="absent_penalty" name="absent_penalty" class="form-control" value="0" required>
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="performance_penalty">Performance Penalty:<span class="asteriskField">*</span></label>
                                                        <input type="number" id="performance_penalty" name="performance_penalty" class="form-control" value="0" required>
                                                    </div>
                                                </div>
                                            </div>
                                            {% comment %} bonuses performance, overtime {% endcomment %}
                                            <div class="tab-pane fade" id="bonuses" role="tabpanel" aria-labelledby="bonuses-tab">
                                                <div class="form-row">
                                                    <div class="form-group col-md-6">
                                                        <label for="performance_bonus">Performance Bonus:<span class="asteriskField">*</span></label>
                                                        <input type="number" id="performance_bonus" name="performance_bonus" class="form-control" value="0" required>
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="overtime_bonus">Overtime Bonus:<span class="asteriskField">*</span></label>
                                                        <input type="number" id="overtime_bonus" name="overtime_bonus" class="form-control" value="0" required>
                                                    </div>
                                                </div>
                                                <div class="form-row">
                                                    <div class="form-group col-md-6">
                                                        <label for="payment_status">Payment Status<span class="asteriskField">*</span></label>
                                                        <select name="payment_status" class="form-control">
                                                            <option value="Pending">Pending</option>
                                                            <option value="Paid">Paid</option>
                                                            <option value="Delayed">Delayed</option>
                                                            <option value="Cancelled">Cancelled</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="form-row btnHandle">
                                                    <button type="submit" class="btn btn-primary">Create Payroll</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                            <div class="container multiUpload empModalContainer" id="payrollUploadForm">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">&times;</button>
                                <form action="{% url 'create_payroll_file' branch_id %}" method="post" enctype="multipart/form-data">
                                    {% csrf_token %}

                                    <div class="up-upload-header">
                                        <h2>Upload Employee Payroll Records</h2>
                                        <p class="up-info-text">Easily upload payroll records for existing employees using an Excel or CSV file.</p>
                                    </div>
                                    
                                    <div class="up-instructions">
                                        <ul class="up-instruction-list">
                                            <li>
                                                <span class="up-highlight">Employee ID:</span>
                                                <strong>Required:</strong> Enter the existing and <strong>accurate</strong> employee ID for each payroll record. Uploading a record with a non-existent employee ID will cause errors.
                                                <strong>Tip:</strong> To ensure accuracy, consider exporting a list of all employees with their IDs (using the print button in the Employee Management section) and copying them into your upload file.
                                            </li>                                          
                                            <li>
                                                <span class="up-highlight">Other Fields:</span>
                                                Fill out the remaining fields with accurate payroll information.  Empty fields will have a default value of 0.
                                            </li>
                                            </li>
                                            <li>
                                                <span class="up-highlight">File Requirements:</span>
                                                <ul>
                                                    <li>Excel (.xls, .xlsx) or CSV format</li>
                                                    <li>Not password protected</li>
                                                </ul>
                                            </li>
                                            <li>
                                                <span class="up-highlight">Important:</span>
                                                <ul>
                                                    <li>
                                                        The first two rows in the sample template are for illustration only. Please delete them before upload.
                                                    </li>
                                                    <li>
                                                        Data entry mistakes may lead to upload errors. Carefully review entries before uploading.
                                                    </li>
                                                </ul>
                                            </li>
                                        </ul>
                            
                                        <p class="up-download-text">Download a sample template:</p>
                                        <b>
                                            <a href="{% static 'sample/excel/payroll_template.xlsx' %}" download class="up-download-link">Excel (.xls, .xlsx)</a> or
                                            <a href="{% static 'sample/csv/payroll_template.csv' %}" download class="up-download-link"> CSV</a>
                                        </b>
                                    </div>   
                                    {% crispy payroll_upload_form %}
                                </form>
                            </div>   
                        </div> 
                    </div>
                
                    {% comment %} Leave Request {% endcomment %}
                    <!-- Leave Requests content -->
                    <div class="tab-contents3" id="payroll-list">
                        {% if payroll %}
                        <div class="searchFlex">
                            <h4>Payroll List</h4> <button class="btn btn-primary" onclick="window.print()">Print</button>
                        </div>
                        <table class="dataTable apply-leave">
                        <thead>
                            <tr>
                                <th>SN</th>
                            <th>Employee</th>
                            <th>Month</th>
                            <th>Total Deduction</th>
                            <th>Total Bonus</th>
                            <th>Total Payment</th>
                            <th>Status</th>
                            <th>Actions</th>
                            </tr>
                        </thead>
                        
                        <tbody class="employee-table-body">
                            {% for payroll in payroll %}
                            <tr class="s-card">
                            <td>{{ forloop.counter }}</td>
                            <td class="sf1">{{ payroll.employee.first_name }}{{ payroll.employee.last_name}}</td>
                            <td class="sf2" >{{ payroll.month|month_name }}</td>
                            <td>{{ payroll.total_deductions|intcomma }}</td>
                            <td>{{ payroll.total_allowance|intcomma }}</td>
                            <td>{{ payroll.net_pay|intcomma }}</td>
                            <td>{{ payroll.payment_status }}</td>
                            <td>
                                <div class="dropdown">
                                    <i class="fas fa-ellipsis-h" aria-hidden="true"></i>
                                    <div class="dropdown-menu">
                                        <center>
                                            <ul>
                                                <li><a class="moreEmpDetail" href="{% url 'payroll_detail' payroll.id %}" class="btn btn-primary btn-sm">View</a></li>
                                                <li><a class="moreEmpDetail" href="{% url 'update_payroll' payroll.id %}" class="btn btn-primary btn-sm">Update</a></li>
                                                <li><a class="moreEmpDetail" href="{% url 'delete_payroll' payroll.id %}" class="btn btn-primary btn-sm">Delete</a></li>
                                                <li><a class="moreEmpDetail" href="{% url 'payroll_history' payroll.employee.employee_id %}" class="btn btn-primary btn-sm">History</a></li>
                                            </ul>
                                        </center>
                                    </div>
                                </div>
                            </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        </table>
                        {% else %}
                        <center>
                            <h4>No payrolls yet</h4>
                            <p>Payrolls will be displayed here</p>
                        </center>
                        {% endif %}
                    </div>                     
                
                    {% comment %} Leave Statistics {% endcomment %}
                    <div class="tab-contents3 statistics" id="payroll-statistics">
                        <h2>Payroll Statistics</h2>
                        <div class="statistics-grid">
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="statistic-info">
                                    <h3>Total Employees</h3>
                                    {% if total_employees_count is not None %}
                                        <p class="statsVal">{{ total_employees_count|intcomma }}</p>
                                    {% else %}
                                        <p class="statsVal" style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                    <i class="fas fa-wallet"></i>
                                </div>
                                <div class="statistic-info">
                                    <h3>Total Payroll</h3>
                                    {% if total_payment is not None %}
                                        <p class="statsVal">${{ total_payment|intcomma }}</p>
                                    {% else %}
                                        <p class="statsVal" style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                    <i class="fas fa-money-check-dollar badStat"></i>
                                </div>
                                <div class="statistic-info">
                                    <h3>Total Deductions</h3>
                                    {% if total_deductions is not None %}
                                        <p class="statsVal">${{ total_deductions|intcomma }}</p>
                                    {% else %}
                                        <p class="statsVal" style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                    <i class="fas fa-dollar-sign goodStat"></i>
                                </div>
                                <div class="statistic-info">
                                    <h3>Total Bonus</h3>
                                    {% if total_allowances %}
                                        <p class="statsVal">${{ total_allowances|intcomma }}</p>
                                    {% else %}
                                        <p class="statsVal" style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                    <i class="fas fa-hand-holding-usd"></i>
                                </div>
                                <div class="statistic-info">
                                    <h3>Total Net Pay</h3>
                                    {% if total_netpay is not None %}
                                        <p class="statsVal">${{ total_netpay|intcomma }}</p>
                                    {% else %}
                                        <p class="statsVal" style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                    <i class="fas fa-coins"></i>
                                </div>
                                <div class="statistic-info">
                                    <h3>Average Salary</h3>
                                    {% if average_salary is not None %}
                                        <p class="statsVal">${{ average_salary|intcomma }}</p>
                                    {% else %}
                                        <p class="statsVal" style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                            <!-- Add more statistics items as needed -->
                        </div>
                    </div>

                    {% comment %} Bank Info {% endcomment %}
                    <div class="tab-contents3 view-bank-info" id="bank-info">
                        {% if employees %}
                        <div class="searchFlex">
                            <h4>Bank Information</h4> <button class="btn btn-primary" onclick="window.print()">Print</button>
                        </div>
                        <table class="dataTable">
                            <thead>
                                <tr>
                                    <th>SN</th>
                                    <th>ID</th>
                                    <th>Employee</th>
                                    <th>Bank</th>
                                    <th>Account No.</th>
                                    <th>Acct. Name</th>
                                    <th>Pension ID</th>
                                    <th>Salary</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody class="employee-table-body">
                                {% for employee in employees %}
                                <tr class="s-card">
                                    <td>{{ forloop.counter }}</td>
                                    <td class="sf1">{{ employee.employee_id }}</td>
                                    <td class="sf2">{{ employee.first_name }} {{ employee.last_name }}</td>
                                    <td class="sf5">{{ employee.bank_name }}</td>
                                    <td class="sf3">{{ employee.account_number }}</td>
                                    <td class="sf4" >{{ employee.account_name }}</td>
                                    <td>{{ employee.pension_id }}</td>
                                    <td>{{ employee.basic_salary|intcomma }}</td>
                                    <td class="controlButton">
                                        <button class="edit-bank btn btn-block " data-employeeid="{{ employee.pk }}">Update</button>
                                    </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                            {% else %}
                            <center>
                                <h4>No bank information available</h4>
                                <p>Bank information will be displayed here</p>
                            </center>
                            {% endif %}
                    </div>     

                    <div id="updateBankContainer" class="archive-modal">
                        <form id="updateBankForm" method="post" class="container mt-5 mb-5 modal-content">
                            {% csrf_token %}
                            <button type="button" class="close close-btn" data-dismiss="modal" aria-label="Close">
                                <span class="close openFlashMsg" aria-hidden="true" onclick="getElementById('updateBankContainer').style.display='none'">&times;</span>
                            </button>
                            <center><h3>Update Bank Data</h3></center>
                                <hr>
                                <input type="hidden" id="empId" value="">
                            <fieldset>
                                    <legend><h4>Bank Details</h4></legend>
                                    <div class="bankDetail">
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label for="bankNameBank">Bank Name</label>
                                                <input type="text" id="bankNameBank" name="bank_name" class="form-control" value="">
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label for="accountNumberBank">Account Number</label>
                                                <input type="text" id="accountNumberBank" name="account_number" class="form-control" value="">
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label for="accountNameBank">Account Name</label>
                                                <input type="text" id="accountNameBank" name="account_name" class="form-control" value="">
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label for="pensionIdBank">Pension ID</label>
                                                <input type="text" id="pensionIdBank" name="pension_id" class="form-control" value="">
                                            </div>
                                        </div>
                                    </div>
                            </fieldset>
                            <div style="display: flex; justify-content: space-around;">
                                <button type="button" class="btn btn-primary cancelBtn" style="background-color: red;">Cancel</button>
                                <button type="submit" class="btn btn-primary" id="updateEmployeeBankBtn">Update</button>
                            </div>
                        </form>
                    </div>
                            
                </div>


                {% comment %} Performance Management {% endcomment %}
                <div class="performance mgt">
                    <div class="menuToggle">
                        <h3 class="hidePrint">Employee Performance</h3> <span class="menu-toggle-icon"><i class="fas fa-bars"></i></span>
                    </div>
                
                    <div class="performance-navigation actions">
                        <div class="fgroup">
                            <button class="tab4 nav-tab active" data-tab4="performance-overview"><i class="fas fa-users"></i> <span class="tabTitle">Employees</span></button>
                            <button class="tab4 nav-tab" data-tab4="performance-list"><i class="fas fa-list"></i> Summary</button>
                        </div>
                        <div class="fgroup">
                            <button class="tab4 nav-tab" data-tab4="high-performers"><i class="fas fa-arrow-alt-circle-up"></i> Achievers</button>
                            <button class="tab4 nav-tab" data-tab4="underperformance"><i class="fas fa-arrow-alt-circle-down"></i> Achievers</button>
                        </div>
                        <div class="fgroup">
                            <button class="tab4 nav-tab" data-tab4="statistics"><i class="fas fa-chart-line"></i> Stats</button>
                        </div>
                    </div>
                    


                    {% comment %} overview {% endcomment %}
                    <div class="tab-contents4" id="performance-overview">
                        {% if employees %}
                        <div class="searchFlex">
                            <h4>Overview</h4> <button class="btn btn-primary" onclick="window.print()">Print</button>
                        </div>
                        <table class="dataTable">
                            <thead>
                                <tr>
                                    <th>SN</th>
                                    <th>Name</th>
                                    <th>Dept</th>
                                    <th>Review</th>
                                    <th>Rating</th>
                                    <th>Date</th>
                                    <th>More</th>
                                </tr>
                            </thead>
                            <tbody class="employee-table-body">
                                {% for emp in employees %}
                                <tr class="s-card">
                                    <td>{{ forloop.counter }}</td>
                                    <td class="sf1">{{ emp.first_name }} {{ emp.last_name }} </td>
                                    <td class="sf2">{{ emp.department }}</td>
                                    <td title="{{emp.performance.first.performance_review}}">{{ emp.performances.first.performance_review|default:'No reviews'|truncatechars:'30'}}</td>
                                    <td class="sf3">
                                        {% if emp.performances.first.performance_rating %}
                                            {{ emp.performances.first.performance_rating }}%
                                        {% else %}
                                            None
                                        {% endif %}
                                    </td>                                
                                    <td>{{ emp.updated_at|date:'d/m/y' }}</td>
                                    <td class="controlButton">
                                        <a class="pf-btn btn  btn-primary" href="{% url 'performance_dashboard' emp.employee_id %}" target="_blank">Review</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <center>
                            <h4>No Employees yet</h4>
                            <p>Employees review will be displayed here</p>
                        </center>
                        {% endif %}                        
                    </div>

                    {% comment %} Performance Summary {% endcomment %}
                    <div class="tab-contents4" id="performance-list">
                        {% if performance %}
                        <div class="searchFlex">
                            <h4>Performance Summary</h4> <button class="btn btn-primary" onclick="window.print()">Print</button>
                        </div>
                        <table class="dataTable">
                            <thead>
                                <tr>
                                    <th>SN</th>
                                    <th>Name</th>
                                    <th>Dept</th>
                                    <th>Review</th>
                                    <th>Rating</th>
                                    <th>Date</th>
                                    <th>More</th>
                                </tr>
                            </thead>
                            <tbody class="employee-table-body">
                                {% for perf in performance %}
                                <tr class="s-card">
                                    <td>{{ forloop.counter }}</td>
                                    <td class="sf1">{{ perf.employee.first_name }} {{ perf.employee.last_name }} </td>
                                    <td >{{ perf.employee.department }}</td>
                                    <td class="sf2" title="{{perf.performance_review}}">{{ perf.performance_review|default:"No review yet"|truncatechars:20 }}</td>

                                    {% if perf.performance_rating %}
                                    <td class="sf3">{{ perf.performance_rating}}%</td>
                                    {% else %}
                                    <td>None</td>
                                    {% endif %}
                                    <td>{{ perf.updated_at|date:'d/m/y' }}</td>

                                    <td class="controlButton2">
                                        <a class="pf-btn approve" href="{% url 'performance_dashboard' perf.employee.employee_id %}" target="_blank" rel="noreferrer"> Detail</a> 
                                        <a class="del-pf-btn reject" href="{% url 'delete_performance' perf.pk %}">Delete</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <center>
                            <h4>No Employee Performance yet</h4>
                            <p>Performance Overview will be displayed here</p>
                        </center>
                        {% endif %}                        
                    </div>
                    
                    {% comment %} High Performers Summary {% endcomment %}
                    <div class="tab-contents4" id="high-performers">
                        {% if high_performers %}
                        <div class="searchFlex">
                            <h3>High Performers</h3> <button class="btn btn-primary" onclick="window.print()">Print</button>
                        </div>
                        <table class="dataTable">
                            <thead>
                                <tr>
                                    <th>SN</th>
                                    <th>Name</th>
                                    <th>Dept</th>
                                    <th>Review</th>
                                    <th>Rating</th>
                                    <th>Date</th>
                                    <th>More</th>
                                </tr>
                            </thead>
                            <tbody class="employee-table-body">
                                {% for perf in high_performers %}
                                <tr class="s-card">
                                    <td>{{ forloop.counter }}</td>
                                    <td class="sf1">{{ perf.employee.first_name }} {{ perf.employee.last_name }} </td>
                                    <td class="sf2">{{ perf.employee.department }}</td>
                                    {% if perf.performance_review|length > 30 %}
                                        <td>{{ perf.performance_review|slice:':30'}}...</td>
                                    {% elif perf.performance_review|length > 0 %}
                                        <td>{{ perf.performance_review }}</td>
                                    {% else %}
                                        <td>No review yet</td>
                                    {% endif %}
                                    {% if perf.performance_rating %}
                                    <td class="sf3">{{ perf.performance_rating }}%</td>
                                    {% else %}
                                    <td>None</td>
                                    {% endif %}
                                    <td>{{ perf.updated_at|date:'d/m/y' }}</td>
                                    <td class="controlButton">
                                        <a class="pf-btn btn btn-block" href="{% url 'performance_dashboard' perf.employee.employee_id %}">Detail</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <center>
                            <h4>No High Performers </h4>
                            <p>Performance rating of <b style="color: lime;">80+</b> will be displayed here</p>
                        </center>
                        {% endif %}                        
                    </div>

                    {% comment %} Underperformance Summary {% endcomment %}
                    <div class="tab-contents4" id="underperformance">
                        {% if underperformance %}
                        <div class="searchFlex">
                            <h3>Underperformance</h3> <button class="btn btn-primary" onclick="window.print()">Print</button>
                        </div>
                        <table class="dataTable">
                            <thead>
                                <tr>
                                    <th>SN</th>
                                    <th>Name</th>
                                    <th>Dept</th>
                                    <th>Review</th>
                                    <th>Rating</th>
                                    <th>Date</th>
                                    <th>More</th>
                                </tr>
                            </thead>
                            <tbody class="employee-table-body">
                                {% for perf in underperformance %}
                                <tr class="s-card">
                                    <td>{{ forloop.counter }}</td>
                                    <td class="sf1">{{ perf.employee.first_name }} {{ perf.employee.last_name }} </td>
                                    <td class="sf2">{{ perf.employee.department }}</td>
                                    {% if perf.performance_review|length > 30 %}
                                    <td>{{ perf.performance_review|slice:':30'}}...</td>
                                    {% elif perf.performance_review|length > 0 %}
                                    <td>{{ perf.performance_review }}</td>
                                    {% else %}
                                    <td>No review yet</td>
                                    {% endif %}
                                    {% if perf.performance_rating %}
                                    <td class="sf3">{{ perf.performance_rating }}%</td>
                                    {% else %}
                                    <td>None</td>
                                    {% endif %}
                                    <td>{{ perf.updated_at|date:'d/m/y' }}</td>
                                    <td class="controlButton">
                                        <a class="pf-btn btn btn-block" href="{% url 'performance_dashboard' perf.employee.employee_id %}">Detail</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <center>
                            <h4>No Underperforming Employees</h4>
                            <p>Performance rating less than <b>60</b> will be displayed here</p>
                        </center>
                        {% endif %}                        
                    </div>


                
                    {% comment %} Performance Statistics {% endcomment %}
                    <div class="tab-contents4 statistics" id="statistics">
                        <div class="container">
                            <h2>Performance Statistics</h2>
                            <div class="statistics-grid">
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="statistic-info">
                                <h3>Total Employees</h3>
                                    {% if total_employees_count is not None %}
                                    <p class="statsVal">{{ total_employees_count|intcomma }}</p>
                                    {% else %}
                                        <p class="statsVal" style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="statistic-info">
                                <h3>Performance Average</h3>
                                {% if average_performance_rating is not None %}
                                    <p class="statsVal">{{ average_performance_rating|floatformat:'2'|intcomma }}%</p>
                                    {% else %}
                                        <p class="statsVal" style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                <i class="fas fa-chart-pie goodStat"></i>
                                </div>
                                <div class="statistic-info">
                                <h3>Top Performers</h3>
                                {% if high_performers is not None %}
                                    <p class="statsVal">{{ high_performers.count|intcomma }}</p>
                                    {% else %}
                                        <p class="statsVal" style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                <i class="fas fa-chart-bar"></i>
                                </div>
                                <div class="statistic-info">
                                <h3>Improvement Rate</h3>
                                {% if improvement_rate is not None %}
                                    <p class="statsVal">{{ improvement_rate|floatformat:"2"|intcomma }}%</p>
                                    {% else %}
                                        <p class="statsVal" style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                <i class="fas fa-star" style="color: gold;"></i>
                                </div>
                                <div class="statistic-info">
                                <h3>Highest Rating</h3>
                                    {% if highest_rating is not None %}
                                        <p class="statsVal">{{ highest_rating }}</p>
                                        {% else %}
                                            <p class="statsVal" style="color: red;">N/A</p>
                                        {% endif %}
                                </div>
                            </div>
                            <div class="statistic-item">
                                <div class="statistic-icon">
                                <i class="fas fa-heartbeat"></i>
                                </div>
                                <div class="statistic-info">
                                <h3>Employee Engagement</h3>
                                {% if employee_engagement is not None %}
                                    <p class="statsVal">{{ employee_engagement }}</p>
                                    {% else %}
                                        <p class="statsVal" style="color: red;">N/A</p>
                                    {% endif %}
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>
                </div>

                

                {% comment %} Transfer Management {% endcomment %}
                <div class="transfers mgt">
                    <div class="menuToggle">
                        <h3 class="hidePrint">Manage Transfers</h3> <span class="menu-toggle-icon"><i class="fas fa-bars"></i></span>
                    </div>
                
                    <div class="performance-navigation actions">
                        <div class="fgroup">
                            <button class="tab6 nav-tab active" data-tab6="transfer-request"><i class="fas fa-exchange-alt"></i> Request</button>
                            <button class="tab6 nav-tab" data-tab6="pending-transfers"><i class="fas fa-hourglass-half"></i> Pending</button>
                        </div>
                        <div class="fgroup">
                            <button class="tab6 nav-tab" data-tab6="declined-transfers"><i class="fas fa-times-circle"></i> Declined</button>
                            <button class="tab6 nav-tab" data-tab6="transfer-history"><i class="fas fa-history"></i> History</button>
                        </div>
                        <div class="fgroup">
                            <button class="tab6 nav-tab stretch" data-tab6="transfer-statistics"><i class="fas fa-chart-bar"></i> Stats</button>
                        </div>
                    </div>
                    
                    {% comment %} Make a transfer request {% endcomment %}
                    <div class="tab-contents6" id="transfer-request">
                        <h4>Make Transfer Request</h4>
                        {% if transfer_form %}
                            <div class="transfer-form">
                                <form action="{% url 'transfer_request' %}" method="post">
                                    {% csrf_token %}
                                    {% crispy transfer_form %}
                                </form>
                            </div>
                        {% else %}
                            <center>
                                <h4>No Transfer Form</h4>
                                <p>Transfer form will be displayed here</p>
                            </center>
                        {% endif %}
                    </div>
            
                    {% comment %} Pending Requests Summary {% endcomment %}
                    <div class="tab-contents6" id="pending-transfers">
                        <div class="searchFlex">
                            <h4>Pending Requests</h4><button class="btn btn-primary" onclick="window.print()">Print</button>
                        </div>
                        {% if pending_transfers %}
                        <table class="dataTable">
                            <thead>
                                <tr>
                                    <th>SN</th>
                                    <th>Name</th>
                                    <th>Dept</th>
                                    <th>Reason</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>More</th>
                                </tr>
                            </thead>
                            <tbody class="employee-table-body">
                                {% for transfer in pending_transfers %}
                                <tr class="s-card">
                                    <td>{{ forloop.counter }}</td>
                                    <td class="sf1">{{ transfer.employee.first_name }} {{ transfer.employee.last_name }} </td>
                                    <td class="sf3">{{ transfer.employee.department }}</td>
                                    {% if transfer.reason|length > 30 %}
                                    <td>{{ transfer.reason|slice:':30'}}...</td>
                                    {% elif transfer.reason|length > 0 %}
                                    <td>{{ transfer.reason }}</td>
                                    {% else %}
                                    <td>None</td>
                                    {% endif %}
                                    <td class="sf2">{{ transfer.status }}</td>
                                    <td>{{ transfer.created_at|date:'d/m/y' }}</td>
                                    <td class="controlButton">
                                        <a class="tr-btn" href="{% url 'cancel_transfer' transfer.id %}">Cancel</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <center>
                            <h4>No Pending Transfers </h4>
                            <p> Pending transfers will be displayed here</p>
                        </center>
                        {% endif %}                        
                    </div>

                    {% comment %} Declined Requests Summary {% endcomment %}
                    <div class="tab-contents6" id="declined-transfers">
                        <div class="searchFlex">
                            <h4>Declined Requests</h4><button class="btn btn-primary" onclick="window.print()">Print</button>
                        </div>
                        {% if declined_transfers %}
                        <table class="dataTable">
                            <thead>
                                <tr>
                                    <th>SN</th>
                                    <th>Name</th>
                                    <th>Dept</th>
                                    <th>Reason</th>
                                    <th>Status</th>
                                    <th>Decline Date</th>
                                </tr>
                            </thead>
                            <tbody class="employee-table-body">
                                {% for transfer in declined_transfers %}
                                <tr class="s-card">
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ transfer.employee.first_name }} {{ transfer.employee.last_name }} </td>
                                    <td>{{ transfer.employee.department }}</td>
                                    {% if transfer.reason|length > 30 %}
                                    <td>{{ transfer.reason|slice:':30'}}...</td>
                                    {% elif transfer.reason|length > 0 %}
                                    <td>{{ transfer.reason }}</td>
                                    {% else %}
                                    <td>None</td>
                                    {% endif %}
                                    <td>{{ transfer.status }}</td>
                                    <td>{{ transfer.updated_at|date:'d/m/y' }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <center>
                            <h4>No Declined Transfers </h4>
                            <p> Declined transfers will be displayed here</p>
                        </center>
                        {% endif %}                        
                    </div>
                
                    {% comment %} Underperformance Summary {% endcomment %}
                    <div class="tab-contents6" id="transfer-history">
                        <div class="searchFlex">
                            <h4>Transfer History</h4><button class="btn btn-primary" onclick="window.print()">Print</button>
                        </div>
                        {% if transfer_history %}
                        <table class="dataTable">
                            <thead>
                                <tr>
                                    <th>SN</th>
                                    <th>Name</th>
                                    <th>Dept</th>
                                    <th>Reason</th>
                                    <th>Status</th>
                                    <th>New Branch</th>
                                    <th>Approval Date</th>
                                </tr>
                            </thead>
                            <tbody class="employee-table-body">
                                {% for transfer in transfer_history %}
                                <tr class="s-card">
                                    <td>{{ forloop.counter }}</td>
                                    <td class="sf1">{{ transfer.employee.first_name }} {{ transfer.employee.last_name }} </td>
                                    <td class="sf2">{{ transfer.employee.department }}</td>
                                    {% if transfer.reason|length > 30 %}
                                    <td>{{ transfer.reason|slice:':30'}}...</td>
                                    {% elif transfer.reason|length > 0 %}
                                    <td>{{ transfer.reason }}</td>
                                    {% else %}
                                    <td>None</td>
                                    {% endif %}
                                    <td>{{ transfer.status }}</td>
                                    <td class="sf1">{{ transfer.employee.branch.name }}</td>
                                    <td>{{ transfer.updated_at|date:'d/m/y' }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <center>
                            <h4>No Transfers </h4>
                            <p> All approved transfers will be displayed here</p>
                        </center>
                        {% endif %}                     
                    </div>

                    {% comment %} Employee transfers {% endcomment %}
                    <div class="tab-contents6 statistics" id="transfer-statistics">
                        <div class="container">
                            <h3>Transfer Statistics</h3>
                            <div class="statistics-grid">
                                <div class="statistic-item">
                                    <div class="statistic-icon">
                                        <i class="fas fa-exchange-alt"></i>
                                    </div>
                                    <div class="statistic-info">
                                        <h3>Total Transfers</h3>
                                        {% if transfers is not None %}
                                            <p class="statsVal">{{ transfers.count|intcomma }}</p>
                                        {% else %}
                                            <p class="statsVal" style="color: red;">N/A</p>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="statistic-item">
                                    <div class="statistic-icon">
                                        <i class="fas fa-check-circle goodStat"></i>
                                    </div>
                                    <div class="statistic-info">
                                        <h3>Approved Transfers</h3>
                                        {% if approved_transfers is not None %}
                                            <p class="statsVal">{{ approved_transfers.count|intcomma }}</p>
                                        {% else %}
                                            <p class="statsVal" style="color: red;">N/A</p>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="statistic-item">
                                    <div class="statistic-icon">
                                        <i class="fas fa-times-circle badStat"></i>
                                    </div>
                                    <div class="statistic-info">
                                        <h3>Declined Transfers</h3>
                                        {% if declined_transfers is not None %}
                                            <p class="statsVal">{{ declined_transfers.count|intcomma }}</p>
                                        {% else %}
                                            <p class="statsVal" style="color: red;">N/A</p>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="statistic-item">
                                    <div class="statistic-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="statistic-info">
                                        <h3>Total Employees</h3>
                                        {% if employees is not None %}
                                            <p class="statsVal">{{ employees.count|intcomma }}</p>
                                        {% else %}
                                            <p class="statsVal" style="color: red;">N/A</p>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="statistic-item">
                                    <div class="statistic-icon">
                                        <i class="fas fa-arrow-alt-circle-down goodStat"></i>
                                    </div>
                                    <div class="statistic-info">
                                        <h3>Incoming Transfers</h3>
                                        {% if incoming_transfers_count is not None %}
                                        <p class="statsVal">{{ incoming_transfers_count }}</p>
                                        {% else %}
                                        <p class="statsVal" style="color: red;">N/A</p>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="statistic-item">
                                    <div class="statistic-icon">
                                        <i class="fas fa-arrow-alt-circle-up"></i>
                                    </div>
                                    <div class="statistic-info">
                                        <h3>Outgoing Transfers</h3>
                                        {% if outgoing_transfers_count is not None %}
                                        <p class="statsVal">{{ outgoing_transfers_count }}</p>
                                        {% else %}
                                        <p class="statsVal" style="color: red;">N/A</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                {% comment %} Account Settings {% endcomment %}
                <div class="settings mgt">
                    <div class="menuToggle">
                        <h3>Account Settings</h3> <span class="menu-toggle-icon"><i class="fas fa-bars"></i></span>
                    </div>
                    <div class="settings-navigation actions">
                        <div class="fgroup">
                            <button class="tab5 nav-tab active" data-tab5="update-profile"><i class="fas fa-user"></i> Profile</button>
                            <button class="tab5 nav-tab" data-tab5="change-passwd"><i class="fas fa-lock"></i> Password</button>
                        </div>
                        <div class="fgroup">
                            <button class="tab5 nav-tab" data-tab5="upload-docs"><i class="fas fa-upload"></i> Uploads</button>
                        </div>
                    </div>
                    
                    {% comment %} Email and Picture update {% endcomment %}
                    <div class="tab-contents5" id="update-profile">
                        <h4>User Profile</h4>
                        <section class="user_details profile-picture">
                            {% if user.profile_picture and user.profile_picture.url %}
                                <img class="profile_dp" src="{{ user.profile_picture.url }}" alt="{{ user.username }}'s pic">
                                <input class="profile-picture-input" type="file" name="profile-picture-file" accept="image/*">
                                <div class="plus_container">
                                    <i class="fas fa-user-edit"></i>
                                </div>
                            {% else %}
                            <img class="profile_dp" src="{% static 'emps/images/default_profile.png' %}" alt="{{user.first_name}}">
                            <input class="profile-picture-input" type="file" name="profile-picture-file" accept="image/*">
                            <div class="upload-overlay">
                                <i class="fas fa-user-edit"></i>
                            </div>
                            {% endif %}
                        </section>    
                        <center>
                            <h4 style="font-family: 'rowdies' ;">Hello {{user.first_name}}</h4>
                            <h5>Update your email or profile picture</h5>
                        </center>
                        {% if profile_form %}
                            <form class="container" method="post" action="{% url 'profile_settings'%}" enctype="multipart/form-data">
                                {% csrf_token %}
                                {% crispy profile_form %}
                            </form>
                        {% else %}
                        <center>
                            <h4>Hello {{ user.username }}</h4>
                        </center>
                        {% endif %}                        
                    </div>
                    
                    {% comment %} Password update {% endcomment %}
                    <div class="tab-contents5" id="change-passwd">
                        <h4>Update Your Password</h4>
                        <div class="profile-picture">
                            <img src="{{user.profile_picture.url}}" alt="dp icon">
                        </div>
                        {% if change_password_form %}
                            <form class="container" method="post" action="{% url 'change_password'%}">
                                {% csrf_token %}
                                {% crispy change_password_form %}
                            </form>
                        {% else %}
                        <center>
                            <h4>Hello {{ user.username }}</h4>
                        </center>
                        {% endif %}                        
                    </div>

                    {% comment %} Password update {% endcomment %}
                    <div class="tab-contents5" id="upload-docs">
                        <h4>Upload docs</h4>
                        <div class="profile-picture">
                            <img src="{{user.profile_picture.url}}" alt="dp icon">
                        </div>
                        {% if branch_documents_form %}
                            <form class="container" method="post" action="{% url 'upload_branch_docs'%}" enctype="multipart/form-data">
                                {% csrf_token %}
                                {% crispy branch_documents_form %}
                            </form>
                        {% else %}
                        <center>
                            <h4>Hello {{ user.username }}</h4>
                        </center>
                        {% endif %}                        
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
