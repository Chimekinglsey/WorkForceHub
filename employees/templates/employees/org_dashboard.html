{% extends 'base/base.html' %}
{% load crispy_forms_tags %}
{% load static %}
{% load humanize %}
{% load filters %}

{% block head %}
    <link rel="stylesheet" href="{% static 'emps/styles/landing_page.css' %}">
    <script src="{% static 'emps/scripts/landing_page.js' %}"></script>
    <link rel="stylesheet" href="{% static 'generic/styles/branch_dashboard.css'%}">
    <script src="{% static 'generic/scripts/branch_dashboard.js'%}"></script>
    <link rel="stylesheet" href="{% static 'emps/styles/org_dashboard.css'%}">
    <link rel="stylesheet" href="{% static 'emps/styles/confirmationModal.css'%}">
    <script src="{% static 'emps/scripts/org_dashboard.js'%}"></script>
{% endblock head %}
{% block dashboard %}{% endblock dashboard %}

{% block title %}{% if org %}{{ org.name }}{% else %}Dashboard{% endif %}{% endblock title %}



{% block signIn %}<a class="loginBtn btn logoutBtn" href="{% url 'logout' %}" >Logout</a>{% endblock signIn %}
{% block signUp %}{% endblock signUp %}

{% block content %}
<div class="host-container">
    <div class="backdrop"></div>

{% comment %} modal to delete delegate {% endcomment %}
    <div id="deleteDelegateModal" class="modal">
        <div class="modal-content">
          <span class="close">&times;</span>
          <h2>Confirm Deletion</h2>
          <p>Are you sure you want to delete this delegate?</p>
          <div class="modal-buttons">
            <button id="cancelConfirmBtn" class="cancelConfirmBtn">Cancel</button>
            <button id="confirmDeleteBtn" class="proceedDeleteBtn">Delete</button>
          </div>
        </div>
    </div>

      {% comment %} modal to delete branch {% endcomment %}
    <div id="deleteBranchModal" class="modal">
        <div class="modal-content">
          <span class="close">&times;</span>
          <h2>Confirm Deletion</h2>
          <p>Are you sure you want to delete this Branch?</p>
          <div class="modal-buttons">
            <button id="cancelConfirmBtn" class="cancelConfirmBtn">Cancel</button>
            <button id="confirmDeleteBtn" class="proceedDeleteBtn">Delete</button>
          </div>
        </div>
    </div>

      {% comment %} Suspend Delegate {% endcomment %}
    <div id="suspendDelegateModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Confirm Suspension</h2>
            <p>Are you sure you want to suspend this delegate?</p>
            <div class="modal-buttons">
                <button id="cancelConfirmBtn" class="cancelConfirmBtn">Cancel</button>
                <button id="confirmSuspendBtn" class="proceedDeleteBtn">Suspend</button>
            </div>
        </div>
    </div>

        {% comment %} Activate delegate modal {% endcomment %}
    <div id="activateDelegateModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Confirm Activation</h2>
            <p>Are you sure you want to activate this delegate?</p>
            <div class="modal-buttons">
                <button id="cancelConfirmBtn" class="cancelConfirmBtn">Cancel</button>
                <button id="confirmActivateBtn" class="proceedDeleteBtn">Activate</button>
            </div>
        </div>
    </div>

    {% comment %} Promote Delegate Modal {% endcomment %}
    <div id="promoteDelegateModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Confirm Promotion</h2>
            <p>Are you sure you want to promote this delegate to an organization admin?</p>
            <p>Once promoted, the delegate will have full access to the organization's data and operations.</p>
            <div class="modal-buttons">
                <button id="cancelConfirmBtn" class="cancelConfirmBtn">Cancel</button>
                <button id="confirmPromoteBtn" class="proceedDeleteBtn">Promote</button>
            </div>
        </div>
    </div>

    {% comment %} Demote Delegate Modal {% endcomment %}
    <div id="demoteAdminModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Confirm Demotion</h2>
            <p>Are you sure you want to demote this delegate to a branch admin?</p>
            <p>Once demoted, the delegate will only have access to the assigned branch's data and operations.</p>
            <div class="modal-buttons">
                <button id="cancelConfirmBtn" class="cancelConfirmBtn">Cancel</button>
                <button id="confirmDemoteBtn" class="proceedDeleteBtn">Demote</button>
            </div>
        </div>
    </div>


    {% comment %} Suspend superuser modal {% endcomment %}
    <div id="suspendAdminModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Confirm Suspension</h2>
            <p>Are you sure you want to suspend this superuser?</p>
            <p>Once suspended, the superuser will not be able to access the organization's data and operations.</p>
            <div class="modal-buttons">
                <button id="cancelConfirmBtn" class="cancelConfirmBtn">Cancel</button>
                <button id="confirmSuspendBtn" class="proceedDeleteBtn">Suspend</button>
            </div>
        </div>
    </div>

    {% comment %} Activate superuser modal {% endcomment %}
    <div id="activateAdminModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Confirm Activation</h2>
            <p>Are you sure you want to activate this superuser?</p>
            <p>Once activated, the superuser will have full access to the organization's data and operations.</p>
            <div class="modal-buttons">
                <button id="cancelConfirmBtn" class="cancelConfirmBtn">Cancel</button>
                <button id="confirmActivateBtn" class="proceedDeleteBtn">Activate</button>
            </div>
        </div>
    </div>

    {% comment %} Delete Organization {% endcomment %}

    <div id="deleteOrgModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Confirm Deletion</h2>
            <center>
                <p>Are you sure you want to delete this organization?</p>
                <p>Once deleted, all data associated with this organization will be lost.
                    This includes all branches, employees, delegate admins, and your own account.
                </p>
            </center>
            {% comment %} Reason for Deleting the Organization {% endcomment %}

            <form>
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="deleteOrgReason">Reason for Deleting:</label>
                        <select class="form-control" id="deleteOrgReason">
                            <option value="">Select Reason</option>
                            <option value="not_needed">No longer needed</option>
                            <option value="restructuring">Restructuring</option>
                            <option value="merger">Merger with another organization</option>
                            <option value="bankruptcy">Bankruptcy</option>
                            <option value="management_decision">Management decision</option>
                            <option value="legal_issues">Legal issues</option>
                            <option value="performance">Poor performance</option>
                            <option value="cost_cutting">Cost-cutting measures</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
        
                    <div class="form-group col-md-6">
                        <label for="deleteOrgDetails">Additional Details (Optional):</label>
                        <textarea class="form-control" id="deleteOrgDetails" rows="2" placeholder="Enter additional details..."></textarea>
                    </div>
                </div>

                <p>Enter <b style="user-select: none;">"Permanently Delete Organization"</b> to proceed</p>
                <input type="text" id="deleteOrgInput" class="form-control" placeholder="Permanently Delete Organization">
            </form>

            <div class="modal-buttons">
                <button id="cancelConfirmBtn" class="cancelConfirmBtn btn btn-secondary">Cancel</button>
                <button id="confirmOrgDeleteBtn" class="proceedDeleteBtn btn btn-danger">Delete</button>
            </div>
        </div>
    </div>

{% comment %} =============FORMS================== {% endcomment %}


      {% comment %} Create Organization Form {% endcomment %}
    <form id="organization-form" method="post" class="container mt-5 tab-contents2">
        <div class="close-btn">
            <span class="close">&times;</span>
        </div>
        <h3>Organization Information</h3>
        <hr>
        {% csrf_token %}
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="name">Name<span class="asteriskField">*</span></label>
                <input type="text" id="name" name="name" class="form-control" required placeholder="Organization/Business name" value="{{org.name|default:''}}">
            </div>
            <div class="form-group col-md-6">
                <label for="industry">Industry<span class="asteriskField">*</span></label>
                <select id="industry" name="industry" class="form-control" required>
                    <option value="">--Select--</option>
                    <option value="Technology" {% if org.industry == "Technology" %} selected {% endif %}>Technology</option>
                    <option value="Healthcare" {% if org.industry == "Healthcare" %} selected {% endif %}>Healthcare</option>
                    <option value="Finance" {% if org.industry == "Finance" %} selected {% endif %}>Finance</option>
                    <option value="Manufacturing" {% if org.industry == "Manufacturing" %} selected {% endif %}>Manufacturing</option>
                    <option value="Education" {% if org.industry == "Education" %} selected {% endif %}>Education</option>
                    <option value="Retail" {% if org.industry == "Retail" %} selected {% endif %}>Retail</option>
                    <option value="Hospitality" {% if org.industry == "Hospitality" %} selected {% endif %}>Hospitality</option>
                    <option value="Other" {% if org.industry == "Other" %} selected {% endif %}>Other</option>
                </select>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="sector">Sector<span class="asteriskField">*</span></label>
                <input type="text" id="sector" name="sector" class="form-control" value="{{org.sector|default:''}}" required placeholder="Enter Industry sector">
            </div>
            <div class="form-group col-md-6">
                <label for="size">Employees<span class="asteriskField">*</span></label>
                <select id="size" name="size" class="form-control" required>
                    <option value="">--Select--</option>
                    <option value="1 - 20" {% if org.size == "1 - 20" %} selected {% endif %}>1 - 20</option>
                    <option value="21 - 100" {% if org.size == "21 - 100" %} selected {% endif %}>21 - 100</option>
                    <option value="101 - 500" {% if org.size == "101 - 500" %} selected {% endif %}>101 - 500</option>
                    <option value="501 - 1000" {% if org.size == "501 - 1000" %} selected {% endif %}>501 - 1000</option>
                    <option value="Above 1000" {% if org.size == "Above 1000" %} selected {% endif %}>Above 1000</option>
                </select>
            </div>            
        </div>

        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="branches">Number of Branches<span class="asteriskField">*</span></label>
                <select id="branches" name="branches" class="form-control" required>
                    <option value="">--Select--</option>
                    <option value="1 - 10" {% if org.branches == "1 - 10" %} selected {% endif %}>1 - 10</option>
                    <option value="10 - 50" {% if org.branches == "10 - 50" %} selected {% endif %}>10 - 50</option>
                    <option value="51 - 100" {% if org.branches == "51 - 100" %} selected {% endif %}>51 - 100</option>
                    <option value="101 - 500" {% if org.branches == "101 - 500" %} selected {% endif %}>101 - 500</option>
                    <option value="Above 500" {% if org.branches == "Above 500" %} selected {% endif %}>Above 500</option>
                </select>
            </div>
            <div class="form-group col-md-6">
                <label for="headquarter">Headquarter<span class="asteriskField">*</span></label>
                <input type="text" id="headquarter" name="headquarter" value="{{org.headquarter|default:''}}" class="form-control" required placeholder="Location of head office">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="contact_phone">Contact Phone<span class="asteriskField">*</span></label>
                <input type="tel" id="contact_phone" name="contact_phone" value="{{org.contact_phone|default:''}}" class="form-control" required placeholder="Enter your business contact phone number">
            </div>
            <div class="form-group col-md-6">
                <label for="contact_email">Contact Email<span class="asteriskField">*</span></label>
                <input type="email" id="contact_email" name="contact_email" value="{{org.contact_email|default:''}}" class="form-control" required placeholder="Enter your business contact email address">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="website">Website</label>
                <input type="url" id="website" name="website" value="{{org.website|default:''}}" class="form-control" placeholder="e.g https://example.org">
            </div>
            <div class="form-group col-md-6">
                <label for="description">Description</label>
                <textarea id="description" name="description" value="{{org.description|default:''}}" class="form-control" placeholder="Optional, describe your organization or business"></textarea>
            </div>
        </div>


        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="mailing_address">Mailing Address</label>
                <input type="text" id="mailing_address" name="mailing_address" value="{{org.mailing_address|default:''}}" class="form-control" placeholder="Optional, enter mailing address">
            </div>

            <div class="form-group col-md-6">
                <label for="employee_benefits">Employee Benefits</label>
                <textarea id="employee_benefits" name="employee_benefits" class="form-control" placeholder="Enter Employee Benefits">{{ org.employee_benefits|default:'' }}</textarea>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="facebook">Facebook</label>
                <input type="url" id="facebook" name="facebook" value="{{org.facebook|default:'https://facebook.com/yourpage'}}" class="form-control presignedUrl" placeholder="https://facebook.com/">
            </div>
            <div class="form-group col-md-6">
                <label for="twitter">Twitter</label>
                <input type="url" id="twitter" name="twitter" value="{{org.twitter|default:'https://x.com/yourpage'}}" class="form-control presignedUrl" placeholder="https://x.com/">
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="linkedin">Linkedin</label>
                <input type="url" id="linkedin" name="linkedin" value="{{org.linkedin|default:'https://linkedin.com/in/yourpage'}}" class="form-control presignedUrl" placeholder="https://linkedin.com/in/">
            </div>
            <div class="form-group col-md-6">
                <label for="certifications">Certifications</label>
                <textarea id="certifications" name="certifications" value="{{org.certifications|default:''}}" class="form-control" placeholder="Enter acquired certifications e.g ISO, SON"></textarea>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
            </div>
            <div class="form-group col-md-6 btnHandle">
                <button id="orgSubmitBtn" type="submit" class="btn btn-primary">Create</button>
            </div>
        </div>
    </form>

    {% comment %} Create Branch Form {% endcomment %}
    <form id="branch-form" class="container mt-5" method="post" enctype="multipart/form-data">
        <div class="close-btn">
            <span class="close">&times;</span>
        </div>
        <h3>Branch Information</h3>
        <hr>
        {% csrf_token %}
        {% crispy form %}
    </form>

    <form id="delegate-admin-form" class="container mt-5" method="post" enctype="multipart/form-data">
        {% if org %}
        <div class="close-btn">
            <span class="close">&times;</span>
        </div>
        <center>
            <h3>Delegate Admin Information</h3>
            <p>Use this form to create a delegate admin for a specific branch within your organization. Delegate admins have restricted access and can manage operations only within their assigned branch.</p>
        </center>
            <hr>
        {% csrf_token %}
        {% crispy delegate_admin_form %}
        {% endif %}
    </form>

    <form id="change_admin_password_form" method="post" action="{% url 'change_password' %}" class="container mt-5">
        <div class="close-btn">
            <span class="close">&times;</span>
        </div>
        <center>
            <h3>Change Your Password</h3>
        </center>
            <hr>
        {% csrf_token %}
        {% crispy admin_password_form%}
    </form>


    {% comment %} Reset Delegate Form {% endcomment %}
    {% if delegate_admins%}
        <form id="reset_delegate_password" class="container mt-5" action="{% url 'reset_delegate_password' %}" method="post">
            {% csrf_token %}
            <div class="close-btn">
                <span class="close">&times;</span>
            </div>
            <center>
                <h3>Reset Delegate Password</h3>
                <p>Use this form to change or reset a delegate admin's password.</p>
            </center>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="delegate_id">Delegate Admin</label>
                    <select name="delegate_id" id="delegate_id" class="form-control" required>
                        <option value="" disabled>--Select--</option>
                        {% for delegate in delegate_admins %}
                        <option value="{{ delegate.pk }}">{{ delegate.first_name }} {{ delegate.last_name }} - {{ delegate.branch.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group col-md-6">
                    <label for="password">New Password</label>
                    <input type="password" name="password" id="password" class="form-control" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="confirm_password">Confirm Password</label>
                    <input type="password" name="confirm_password" id="confirm_password" class="form-control" required>
                </div>
                <div class="form-group col-md-6">
                    <label for="can_change_password">Can Change Password?</label>
                    <select name="can_change_password" id="can_change_password" class="form-control" required>
                        <option value="" disabled>--Select--</option>
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
                </div>
            </div>         
            <div class="form-row">
                <div class="form-group btnHandle">
                    <button id="resetDelegateBtn" type="submit" class="btn btn-primary">Reset Password</button>
                </div>
            </div>           
        </form>
    {% endif %}

    {% comment %} Create Superuser Form {% endcomment %}
    <div class="spinner-container">
        <div class="spinner"></div>
    </div>
        
    <!-- error modal -->
    <div id="ErrorModal" class="modal">
        <div class="modal-content">
            <span class="closeModal close">&times;</span>
            <h1 class="error-message"> An Error Occurred</h1>
            <p >There was an issue processing your request. Please try again.</p>
        </div>
    </div>

    <!-- success modal -->
    <div id="SuccessModal" class="modal">
        <div class="modal-content">
            <span class="closeModal close">&times;</span>
            <h1 class="success-message"> Success!</h1>
            <p >Completed Successfully</p>
        </div> 
    </div>

    <div class="create-org">
        <!-- Left Pane -->
        <div class="left-pane-org">
            <div class="left-pane-content">
                <div class="cardie">
                    <section class="user_details">
                        {% if user.profile_picture and user.profile_picture.url %}
                        <img class="tiny_images" src="{{ user.profile_picture.url }}" alt="{{ user.username }}'s pic">
                        {% else %}
                        <img class="tiny_images" src="{% static 'emps/images/default_profile.png' %}" alt="profile pics">
                        {% endif %}
                        <center><p class="user_name">{{ user.username }}</p></center>
                    </section>
                    {% if org %}
                        {% if org.name|length > 15 %}
                        <center class="no-bottom">
                            <p> Welcome Back,</p>
                            <p><b class="org_name">{{ org.name|slice:':15' }}</b>
                            </p>
                        </center> 
                        {% else %}
                            <center class="no-bottom">
                                <p> Welcome Back,</p>
                                <p><b class="org_name">{{ org.name }}</b>
                                </p>
                            </center> 
                        {% endif %}
                    {% endif %}
                </div>
                <div class="ToggleContainer" style="display: none;"> <h4> Dashboard</h4> <div class="rotate180"><i class="fas fa-angle-down"></i></div></div>
                <div class="actionContainer">
                    <div class="mobileLeft">
                        {% if org %}
                        <ul>
                            <li><button class="createBranchBtn">
                                {% if branches %}
                                <i class="fas fa-plus-circle"></i> Add Branch
                                {% else %}
                                <i class="fas fa-plus-circle"></i>Create Branch
                                {% endif %}
                            </button></li>
                            {% if branches %}
                            <li class="createDelegateBtn"><i class="fas fa-user-plus"></i>Add Delegate</li>
                            {% endif %}
                        </ul>
                        {% else %}
                        <ul>
                            <li><button class="createOrgBtn"><i class="fas fa-plus-circle"></i><h5>Create Organization</h5></button></li>
                        </ul>
                        {% endif %}
                        <div class="left-down-content">
                            <div class="action-links">
                                <ul>
                                    <li><a class="listBranches"><i class="fas fa-fw fa-code-branch"></i>Visit Branch</a></li>
                                    <div class="showBranches">
                                        {% if branches %}
                                            <ul>
                                                {% for branch in branches %}
                                                <li class="list-group-item list-color"><a href="{%url 'branch_dashboard' branch.branch_id %}">{{ branch.name }}</a></li>
                                                {% endfor %}
                                            </ul>
                                        {% else %}
                                            <ul>
                                                <li class="list-group-item list-color"><a href="">No Branch Yet</a></li>
                                            </ul>
                                        {% endif %}
                                    </div>
                                    <li><a id="reports" data-content="reports" class=""><i class="fas fa-file-alt fa-fw"></i>Reports</a></li>
                                    <li><a id="transfers" data-content="transfers" class=""><i class="fas fa-exchange-alt fa-fw"></i>Transfers</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="mobileRight">
                        <div class="password">
                            <p class="space-top top1">
                                <a class="manageBranch" data-content="branches" title="Manage branches">
                                    <i class="fas fa-fw fa-sitemap"></i>Branches
                                </a>
                            </p>
                            <p>
                                <a class="delegateBtn" data-content="delegates" title="Manage delegates">
                                    <i class="fas fa-fw fa-users"></i>Delegates
                                </a>
                            </p>
                            <p class="space-top top2">
                                <a class="superuserBtn" data-content="superusers" title="Manage superusers">
                                    <i class="fas fa-fw fa-user-cog"></i>Superusers
                                </a>
                            </p>
                            
                        </div>
                        <div class="password">
                            <p>
                                <a class="adminSettings" id="adminSettingsBtn" data-content="settings">
                                    <i class="fas fa-fw fa-gears"></i>Settings 
                                </a>
                            </p>
                        </div>
                        <div class="logout">
                            <p class="logoutBtn"> <a href="{% url 'logout' %}"><i class="fas fa-sign-out" aria-hidden="true"></i>&nbsp;Logout</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Right Pane -->
        <div class="right-pane-org">
            <!-- Create Organization Card -->
            <div class="right-pane-content">
                <div class="welcome-section mgt2 active">
                    <div class="cardie">
                        {% if org %}
                            <h3>
                                {% if branches %}
                                    Add More Branches
                                {% else %}
                                    Create Branch
                                {% endif %}
                            </h3>
                            {% if branches %}
                                <p>Expand your organization by adding more branches. Manage your workforce across multiple locations efficiently.</p>
                            {% else %}
                                <p>Start managing your organization's workforce efficiently. Create a branch to start working with your employee data seamlessly.</p>
                            {% endif %}
                            <button class="createBranchBtn">
                                {% if branches %}
                                    Add More Branches
                                {% else %}
                                    Create Branch
                                {% endif %}
                            </button>
                        {% else %}
                            <h3>Create Organization</h3>
                            <p>Start managing your organization's workforce efficiently. Create an organization to consolidate and centralize your employee data across branches.</p>
                            <button class="createOrgBtn">Create Organization</button>
                        {% endif %}
                    </div>
                                        {% comment %} floating images {% endcomment %}
                    <div class="landing-left">
                        <h6 class="script">. . . your one-stop solution to employee management</h6>
        
                        <div class="image-slider">
                            <img src="{% static 'base/images/employees2.jpg' %}" alt="slide img2">
                            <img src="{% static 'base/images/employees3.webp' %}" alt="slide img3">
                            <img src="{% static 'base/images/employees4.webp' %}" alt="slide img4">
                            <img src="{% static 'base/images/employees5.png' %}" alt="slide img5">
                            <img src="{% static 'base/images/employees60.jpg' %}" alt="slide img6">
                            <img src="{% static 'base/images/employees7.jpg' %}" alt="slide img7">
                            <img src="{% static 'base/images/employees8.jpg' %}" alt="slide img8">
                            <img src="{% static 'base/images/employees1.jpg' %}" alt="slide img1" class="active">
                            <img src="{% static 'base/images/employees9.webp' %}" alt="slide img9">
                            <img src="{% static 'base/images/employees10.png' %}" alt="slide img10">
                            <img src="{% static 'base/images/employees11.jpg' %}" alt="slide img11">
                            <img src="{% static 'base/images/employees12.jpg' %}" alt="slide img12">
                        </div>
                    </div>
                    <!-- About Card -->
                    <div class="cardie clearfix">
                        <h3>About WorkForceHub</h3>
                        <p>WorkForceHub provides a comprehensive solution for managing your organization's workforce. From payroll to leave management, WorkForceHub streamlines all your HR processes.</p>
                    </div>
        
                    <!-- How it Works Card -->
                    <div class="cardie">
                        <h3>How it Works</h3>
                        <p>After creating your organization, easily manage your employees across branches. Utilize features like payroll management, leave tracking, and inter-branch transfers.</p>
                    </div>
        
                    <!-- Get Started Card -->
                    <div class="cardie">
                        <h3>Get Started</h3>
                        <p>Follow these five simple steps to get started: 
                            <ol>
                                <li>Sign up for WorkForceHub</li>
                                <li>Create your organization</li>
                                <li>Add branches</li>
                                <li>Create delegate admin</li>
                                <li>Start managing your workforce seamlessly</li>
                            </ol>
                            {% if org %}
                                <button class="createBranchBtn"> Add Branches</button>
                            {% else %}
                                <button  class="createOrgBtn">Get started</button>
                            {% endif %}
                    
                    </div>
        
                    <!-- Why Choose WorkForceHub Card -->
                    <div class="cardie">
                        <h3>Why Choose WorkForceHub</h3>
                        <p>Join thousands of organizations that trust WorkForceHub for their HR needs. Experience efficient workforce management, robust security, and exceptional support.</p>
                    </div>
                </div>

                {% comment %} Employee requests {% endcomment %}
                <div class="transfers mgt2">
                    <div class="menuToggle">
                        <h2>Manage Transfer Requests</h2> <span class="menu-toggle-icon"><i class="fas fa-bars"></i> Menu </span>
                    </div>
                
                    <div class="actions">
                        <button class="tab6 nav-tab" data-tab6="pending-transfers">Requests</button>
                        <button class="tab6 nav-tab" data-tab6="declined-transfers">Declined</button>
                        <button class="tab6 nav-tab" data-tab6="approved-transfers">Approved</button>
                        <button class="tab6 nav-tab" data-tab6="transfer-statistics">Statistics</button>
                    </div>
    
                    {% comment %} Pending Requests Summary {% endcomment %}
                    <div class="tab-contents6" id="pending-transfers">
                        <div class="searchFlex">
                            <h3>Pending Requests</h3>
                        </div>
                        {% if pending_transfers %}
                        <table class="dataTable">
                            <thead>
                                <tr>
                                    <th>SN</th>
                                    <th>From</th>
                                    <th>To</th>   
                                    <th>Employee</th>
                                    <th>Dept</th>
                                    <th>Reason</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for transfer in pending_transfers %}
                                <tr>
                                    <td>{{ forloop.counter }}.</td>
                                    <td>{{ transfer.source_branch.name }}</td>
                                    <td>{{ transfer.destination_branch.name }}</td>
                                    <td>{{ transfer.employee.first_name }} {{ transfer.employee.last_name }} </td>
                                    <td>{{ transfer.employee.department }}</td>
                                    {% if transfer.reason|length > 30 %}
                                    <td>{{ transfer.reason|slice:':30'}}...</td>
                                    {% elif transfer.reason|length > 0 %}
                                    <td>{{ transfer.reason }}</td>
                                    {% else %}
                                    <td>None</td>
                                    {% endif %}
                                    <td>{{ transfer.status }}</td>
                                    <td>{{ transfer.created_at|date:'d/m/y' }}</td>
                                    <td class="controlButton">
                                        <button class="approve-transfer-btn approve" data-transferid="{{ transfer.pk }}">Approve</button>
                                        <button class="decline-transfer-btn reject" data-transferid="{{ transfer.pk }}">Decline</button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <center>
                            <h3>No Transfer Requests </h3>
                            <p> Transfer requests from branches will be displayed here</p>
                        </center>
                        {% endif %}                        
                    </div>
    
                    {% comment %} Declined Requests Summary {% endcomment %}
                    <div class="tab-contents6" id="declined-transfers">
                        <div class="searchFlex">
                            <h3>Declined Transfers</h3>
                        </div>
                        {% if declined_transfers %}
                        <table class="dataTable">
                                <thead>
                                    <tr>
                                        <th>SN</th>
                                        <th>From</th>
                                        <th>To</th>   
                                        <th>Employee</th>
                                        <th>Dept</th>
                                        <th>Reason</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                        <th>Declined</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for transfer in declined_transfers %}
                                        <tr>
                                            <td>{{ forloop.counter }}.</td>
                                            <td>{{ transfer.employee.source_branch.name }}</td>
                                            <td>{{ transfer.destination_branch.name }}</td>
                                            <td>{{ transfer.employee.first_name }} {{ transfer.employee.last_name }} </td>
                                            <td>{{ transfer.employee.department }}</td>
                                            {% if transfer.reason|length > 30 %}
                                            <td>{{ transfer.reason|slice:':30'}}...</td>
                                            {% elif transfer.reason|length > 0 %}
                                            <td>{{ transfer.reason }}</td>
                                            {% else %}
                                            <td>None</td>
                                            {% endif %}
                                            <td>{{ transfer.status }}</td>
                                            <td>{{ transfer.created_at|date:'d/m/y' }}</td>
                                            <td>{{ transfer.updated_at|date:'d/m/y' }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <center>
                                <h3>No Declined Requests </h3>
                                <p> Declined transfer requests from branches will be displayed here</p>
                            </center>
                        {% endif %}                        
                    </div>
                
                    {% comment %} Approved Requests Summary {% endcomment %}
                    <div class="tab-contents6" id="approved-transfers">
                        <div class="searchFlex">
                            <h3>Approved Transfers</h3>
                        </div>
                        {% if approved_transfers %}
                        <table class="dataTable">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>From</th>
                                        <th>To</th>   
                                        <th>Employee</th>
                                        <th>Dept</th>
                                        <th>Reason</th>
                                        <th>Status</th>
                                        <th>Req.Date</th>
                                        <th>Approved</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for transfer in approved_transfers %}
                                        <tr>
                                            <td>{{ forloop.counter }}.</td>
                                            <td>{{ transfer.source_branch.name}}</td>
                                            <td>{{ transfer.destination_branch.name }}</td>
                                            <td>{{ transfer.employee.first_name }} {{ transfer.employee.last_name }} </td>
                                            <td>{{ transfer.employee.department }}</td>
                                            {% if transfer.reason|length > 30 %}
                                            <td>{{ transfer.reason|slice:':30'}}...</td>
                                            {% elif transfer.reason|length > 0 %}
                                            <td>{{ transfer.reason }}</td>
                                            {% else %}
                                            <td>None</td>
                                            {% endif %}
                                            <td>{{ transfer.status }}</td>
                                            <td>{{ transfer.created_at|date:'d/m/y' }}</td>
                                            <td>{{ transfer.updated_at|date:'d/m/y' }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <center>
                                <h3>No Approved Requests </h3>
                                <p> Approved branch transfer requests will be displayed here</p>
                            </center>
                        {% endif %}                        
                    </div>
    
                    {% comment %} Employee transfers {% endcomment %}
                    <div class="tab-contents6 statistics" id="transfer-statistics">
                        <div class="container">
                            <h2>Transfer Statistics</h2>
                            <div class="statistics-grid">
                                <div class="statistic-item">
                                    <div class="statistic-icon">
                                        <i class="fas fa-exchange-alt"></i>
                                    </div>
                                    <div class="statistic-info">
                                        <h3>Total Transfers</h3>
                                        {% if transfers is not None %}
                                            <p class="statsVal">{{ transfers.count|intcomma }}</p>
                                        {% else %}
                                            <p class="statsVal" style="color: red;">N/A</p>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="statistic-item">
                                    <div class="statistic-icon">
                                        <i class="fas fa-check-circle goodStat"></i>
                                    </div>
                                    <div class="statistic-info">
                                        <h3>Approved Transfers</h3>
                                        {% if approved_transfers is not None %}
                                            <p class="statsVal">{{ approved_transfers.count|intcomma }}</p>
                                        {% else %}
                                            <p class="statsVal" style="color: red;">N/A</p>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="statistic-item">
                                    <div class="statistic-icon">
                                        <i class="fas fa-times-circle badStat"></i>
                                    </div>
                                    <div class="statistic-info">
                                        <h3>Declined Transfers</h3>
                                        {% if declined_transfers is not None %}
                                            <p class="statsVal">{{ declined_transfers.count|intcomma }}</p>
                                        {% else %}
                                            <p class="statsVal" style="color: red;">N/A</p>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="statistic-item">
                                    <div class="statistic-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="statistic-info">
                                        <h3>Total Employees</h3>
                                        {% if employees %}
                                            <p class="statsVal">{{ employees.count|intcomma }}</p>
                                        {% else %}
                                            <p class="statsVal" style="color: red;">N/A</p>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="statistic-item">
                                    <div class="statistic-icon">
                                        <i class="fas fa-calendar-check"></i>
                                    </div>
                                    <div class="statistic-info">
                                        <h3>Transfers This Month</h3>
                                        {% if monthly_transfer_count is not None %}
                                        <p class="statsVal">{{ monthly_transfer_count }}</p>
                                        {% else %}
                                        <p class="statsVal" style="color: red;">N/A</p>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="statistic-item">
                                    <div class="statistic-icon">
                                        <i class="fas fa-calendar"></i>
                                    </div>
                                    <div class="statistic-info">
                                        <h3>Transfers Last Month</h3>
                                        {% if last_month_transfer_count is not None %}
                                        <p class="statsVal">{{ last_month_transfer_count }}</p>
                                        {% else %}
                                        <p class="statsVal" style="color: red;">N/A</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                {% comment %} Reports {% endcomment %}
                <div id="report-history-modal" class="reports mgt2">
                    <div class="history-container archive-modal-content">
                        <div class="reportStats">
                            <h4>Reports</h4> 
                            <button id="overallStatBtn" class="statsBtn">
                                <a href="{% url 'statistics'%}" target="_blank" rel="noreferrer">Statistics</a>
                                    <i class="fas fa-arrow-alt-circle-right"></i>
                            </button>
                        </div >
                    {% if reports %}
                        <table class="dataTable">
                        <thead>
                            <tr>
                                <th>SN</th>
                                <th>Title</th>
                                <th>Type</th>
                                <th>Category</th>
                                <th>Description</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Branch</th>
                                <th>Created By</th>
                                <th>File</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for report in reports %}
                            <tr>
                                    <td>{{ forloop.counter }}.</td>
                                    <td>{{ report.title }}</td>
                                    <td>{{ report.report_type }}</td>
                                    <td>{{ report.category }}</td>
                                    <td title="{{ report.description }}">{{ report.description|truncatechars:20 }}</td>
                                    <td>{{ report.created_at|date:'d/m/y' }}</td>
                                    <td>{{ report.status }}</td>
                                    <td>{{ report.branch.name }}</td>
                                    <td>{{ report.created_by.get_full_name }}</td>
                                    {% if report.attachments %}
                                    <td><a href="{{report.attachments.url}}" target="_blank">View</a></td>
                                    {% else %}
                                    <td>None</td>
                                    {% endif %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <center class="space-top">
                        <h3>No  Branch Reports </h3>
                        <p> Branch Reports will be displayed here</p>
                    </center>
                    {% endif %} 
                    </div>
                </div>

                {% comment %} Branch and Delegate detail {% endcomment %}
                <div id="branches-modal" class="branches mgt2">
                    <div class="branches-container archive-modal-content">
                        <div class="delegatesView">
                            <h3>Branches</h3> 
                        </div >
                    {% if branches %}
                        <table class="dataTable">
                      <thead>
                        <tr>
                          <th class="no-space">SN</th>
                          <th>Branch Name</th>
                          <th>Location</th>
                          <th>Admin</th>
                          <th class="no-space">Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for branch in branches %}
                        <tr>
                            <td>{{ forloop.counter }}.</td>
                          <td>{{ branch.name }}</td>
                          <td>{{ branch.location }}</td>
                            {% if delegate_admins %}
                                <td>
                                    {% for del in delegate_admins %}
                                        {% if del.branch == branch %}
                                            {{ del.get_full_name }}
                                            {% if not forloop.last %}, {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                </td>
                            {% else %}
                            <td>None</td>
                            {% endif %}
                            <td class="">
                                <div class="dropdown">
                                    <i class="fas fa-ellipsis-h" aria-hidden="true"></i>
                                    <div class="dropdown-menu">
                                        <center>
                                        <ul>
                                            <li><a class="moreEmpDetail updateBranchBtn" href="{% url 'update_branch' branch.branch_id %}" class="btn btn-primary btn-sm">Update</a></li>
                                            <li><a class="moreEmpDetail deleteBranchBtn" data-branchid="{{branch.branch_id}}" class="btn btn-primary btn-sm">Delete</a></li>
                                        </ul>
                                    </center>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                    {% else %}
                    <center class="space-top">
                        <h3>No Branches Yet </h3>
                        <p>Branches  will be displayed here</p>
                    </center>
                    {% endif %} 
                    </div>
                </div>

                {% comment %}Delegates detail {% endcomment %}
                <div id="delegates-modal" class="delegates mgt2">
                    <div class="delegates-container archive-modal-content">
                        <div class="delegatesView">
                            <h3>Delegates</h3> 
                        </div >
                        {% if delegate_admins %}
                            <div class="tableContainer">
                                <table class="dataTable">
                                    <thead>
                                        <tr>
                                            <th>SN</th>
                                            <th>Name</th>
                                            <th>Branch</th>
                                            <th>Last Login</th>
                                            <th>Status</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody class="columnAction">
                                        {% for del in delegate_admins %}
                                            <tr>
                                                <td>{{ forloop.counter }}.</td>
                                                <td>{{ del.get_full_name }}</td>
                                                <td>{{ del.branch.name }}</td>
                                                <td>{{ del.last_login|naturaltime }}</td>
                                                <td>{{ del.employment_status }}</td>
                                                <td class="">
                                                    <div class="dropdown">
                                                        <i class="fas fa-ellipsis-h" aria-hidden="true"></i>
                                                        <div class="dropdown-menu">
                                                            <center>
                                                            <ul>
                                                                <li><a class="moreEmpDetail updateDelegateBtn" data-delegateid="{{ del.pk }}" class="btn btn-primary btn-sm">Update</a></li>
                                                                <li><a class="moreEmpDetail deleteDelegateBtn" data-delegateid="{{ del.pk }}" class="btn btn-primary btn-sm">Delete</a></li>
                                                                <li><a class="moreEmpDetail suspendDelegateBtn" data-delegateid="{{ del.pk }}" class="btn btn-primary btn-sm">Suspend</a></li>
                                                                <li><a class="resetDelegatePwdBtn" class="btn btn-primary btn-sm">Password</a></li>
                                                                {% if del.employment_status == 'Suspended' %}
                                                                    <li><a class="moreEmpDetail activateDelegateBtn" data-delegateid="{{ del.pk }}" class="btn btn-primary btn-sm">Activate</a></li>
                                                                {% endif %}
                                                                <li><a class="moreEmpDetail promoteDelegateBtn" data-delegateid="{{ del.pk }}" class="btn btn-primary btn-sm">Promote</a></li>
                                                                {% if user and user == master_admin and del.is_superuser %}
                                                                    <li><a class="moreEmpDetail demoteAdminBtn" data-delegateid="{{ del.pk }}" class="btn btn-primary btn-sm">Demote</a></li>
                                                                {% endif %}
                                                            </ul>
                                                        </center>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                                <center class="space-top">
                                    <h3>No Delegates Yet </h3>
                                    <p>Delegates  will be displayed here</p>
                                </center>
                        {% endif %} 
                    </div>
                </div>

                {% comment %}Superusers detail {% endcomment %}
                <div id="superusers-modal" class="superusers mgt2">
                <div class="archive-modal-content">
                    <div class="">
                        <h3>Organization Admins</h3> 
                    </div >
                    {% if superusers %}
                        <div class="tableContainer">
                            <table class="dataTable">
                                <thead>
                                    <tr>
                                        <th>SN</th>
                                        <th>Name</th>
                                        <th>Last Login</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody class="columnAction">
                                    {% for admin in superusers %}
                                        <tr>
                                            <td>{{ forloop.counter }}.</td>
                                            <td>{{ admin.get_full_name }}</td>
                                            <td>{{ admin.last_login|naturaltime }}</td>
                                            <td>{{ admin.employment_status }}</td>
                                            <td class="">
                                                {% if user == master_admin %}
                                                    <div class="dropdown">
                                                        <center>
                                                            <i class="fas fa-ellipsis-h" aria-hidden="true"></i>
                                                        </center>
                                                        <div class="dropdown-menu centered above">
                                                            <center>
                                                                <ul>
                                                                    <li><a class="moreEmpDetail suspendAdminBtn" data-delegateid="{{ admin.pk }}" class="btn btn-primary btn-sm">Suspend</a></li>
                                                                    <li><a class="moreEmpDetail demoteAdminBtn" data-delegateid="{{ admin.pk }}" class="btn btn-primary btn-sm">Demote</a></li>
                                                                    {% if admin.employment_status == 'Suspended' %}
                                                                        <li><a class="moreEmpDetail activateAdminBtn" data-delegateid="{{ admin.pk }}" class="btn btn-primary btn-sm">Restore</a></li>
                                                                    {% endif %}
                                                                </ul>
                                                            </center>
                                                        </div>
                                                    </div>
                                                    {% else %}
                                                   <p>Nothing</p> 
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                            <center class="space-top">
                                <h3>No Superusers Yet </h3>
                                <p>Organization Admins  will be displayed here</p>
                            </center>
                    {% endif %} 
                </div>
                </div>


                {% comment %} Settings Dashboard {% endcomment %}
                <div id="adminSettingsModal" class="container text-center mgt2 settings">
                    <!-- Profile Picture -->
                    <section class="user_details profile-picture">
                        {% if user.profile_picture and user.profile_picture.url %}
                        <img class="" src="{{ user.profile_picture.url }}" alt="{{ user.username }}'s pic">
                        {% else %}
                        <img class="" src="{% static 'emps/images/default_profile.png' %}" alt="{{user.first_name}}">
                        {% endif %}
                    </section>        
                    <!-- Dashboard Buttons -->
                    <div class="dashboard-buttons">
                    <button id="changeAdminPasswordBtn" class="btn btn-primary tab2" data-tab2="update_admin_password">Change Password</button>
                    {% if org %}
                        <button id="updateOrgBtn" class="btn btn-secondary tab2" data-tab2="organization-form">Update Organization</button>
                        <button id="deleteOrgBtn" class="btn btn-danger" data-orgid="{{org.org_id}}">Delete Organization</button>
                    {% endif %}
                    </div>


                    <div class="update_admin_password">
                        <form id="update_admin_password_form" method="post" action="{% url 'change_password' %}" class="container mt-5">
                            <div class="close-btn">
                                <span class="close">&times;</span>
                            </div>
                            <center>
                                <h3>Update Your Password</h3>
                            </center>
                                <hr>
                            {% csrf_token %}
                            {% crispy admin_password_form %}
                        </form>
                    </div>
                </div>
            </div>

        </div> 
    </div>
{% comment %} Create Organization Modal Form {% endcomment %}
</div>
{% endblock content %}
<br>